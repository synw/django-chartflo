!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vl={})}(this,function(e){"use strict";function t(e,t,n){return e.fields=t||[],e.fname=n,e}function n(e){throw Error(e)}function r(e){var t,r,i,o=[],a=null,u=0,c=e.length,s="";function l(){o.push(s+e.substring(t,r)),s="",t=r+1}for(e+="",t=r=0;r<c;++r)if("\\"===(i=e[r]))s+=e.substring(t,r),t=++r;else if(i===a)l(),a=null,u=-1;else{if(a)continue;t===u&&'"'===i?(t=r+1,a=i):t===u&&"'"===i?(t=r+1,a=i):"."!==i||u?"["===i?(r>t&&l(),u=t=r+1):"]"===i&&(u||n("Access path missing open bracket: "+e),u>0&&l(),u=0,t=r+1):r>t?l():t=r+1}return u&&n("Access path missing closing bracket: "+e),a&&n("Access path missing closing quote: "+e),r>t&&(r++,l()),o}var i=Array.isArray;function o(e){return e===Object(e)}function a(e){return"string"==typeof e}function u(e){return i(e)?"["+e.map(u)+"]":o(e)||a(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var c=[];(function(e,n){var i=r(e),o="return _["+i.map(u).join("][")+"];";t(Function("_",o),[e=1===i.length?i[0]:e],n||e)})("id"),t(function(e){return e},c,"identity"),t(function(){return 0},c,"zero"),t(function(){return 1},c,"one"),t(function(){return!0},c,"true"),t(function(){return!1},c,"false");function s(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var l=0,f=1,d=2,p=3,h=4;function m(e){return"boolean"==typeof e}function g(e){return"number"==typeof e}function v(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function b(e,t){function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function S(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}var E,w,k,N,O={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},_=function(e){throw{name:"SyntaxError",message:e,at:E,text:k}},T=function(e){return e&&e!==w&&_("Expected '"+e+"' instead of '"+w+"'"),w=k.charAt(E),E+=1,w},C=function(){var e,t="";for("-"===w&&(t="-",T("-"));w>="0"&&w<="9";)t+=w,T();if("."===w)for(t+=".";T()&&w>="0"&&w<="9";)t+=w;if("e"===w||"E"===w)for(t+=w,T(),"-"!==w&&"+"!==w||(t+=w,T());w>="0"&&w<="9";)t+=w,T();if(e=+t,isFinite(e))return e;_("Bad number")},A=function(){var e,t,n,r="";if('"'===w)for(;T();){if('"'===w)return T(),r;if("\\"===w)if(T(),"u"===w){for(n=0,t=0;t<4&&(e=parseInt(T(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof O[w])break;r+=O[w]}else r+=w}_("Bad string")},D=function(){for(;w&&w<=" ";)T()};N=function(){switch(D(),w){case"{":return function(){var e,t={};if("{"===w){if(T("{"),D(),"}"===w)return T("}"),t;for(;w;){if(e=A(),D(),T(":"),Object.hasOwnProperty.call(t,e)&&_('Duplicate key "'+e+'"'),t[e]=N(),D(),"}"===w)return T("}"),t;T(","),D()}}_("Bad object")}();case"[":return function(){var e=[];if("["===w){if(T("["),D(),"]"===w)return T("]"),e;for(;w;){if(e.push(N()),D(),"]"===w)return T("]"),e;T(","),D()}}_("Bad array")}();case'"':return A();case"-":return C();default:return w>="0"&&w<="9"?C():function(){switch(w){case"t":return T("t"),T("r"),T("u"),T("e"),!0;case"f":return T("f"),T("a"),T("l"),T("s"),T("e"),!1;case"n":return T("n"),T("u"),T("l"),T("l"),null}_("Unexpected '"+w+"'")}()}};var I,z,R,L=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,F={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function j(e){return L.lastIndex=0,L.test(e)?'"'+e.replace(L,function(e){var t=F[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}var U="undefined"!=typeof JSON?JSON:{parse:function(e,t){var n;return k=e,E=0,w=" ",n=N(),D(),w&&_("Syntax error"),"function"==typeof t?function e(n,r){var i,o,a=n[r];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(o=e(a,i))?a[i]=o:delete a[i]);return t.call(n,r,a)}({"":n},""):n},stringify:function(e,t,n){var r;if(I="",z="","number"==typeof n)for(r=0;r<n;r+=1)z+=" ";else"string"==typeof n&&(z=n);if(R=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return function e(t,n){var r,i,o,a,u,c=I,s=n[t];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(t)),"function"==typeof R&&(s=R.call(n,t,s)),typeof s){case"string":return j(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(I+=z,u=[],"[object Array]"===Object.prototype.toString.apply(s)){for(a=s.length,r=0;r<a;r+=1)u[r]=e(r,s)||"null";return o=0===u.length?"[]":I?"[\n"+I+u.join(",\n"+I)+"\n"+c+"]":"["+u.join(",")+"]",I=c,o}if(R&&"object"==typeof R)for(a=R.length,r=0;r<a;r+=1)"string"==typeof(i=R[r])&&(o=e(i,s))&&u.push(j(i)+(I?": ":":")+o);else for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(o=e(i,s))&&u.push(j(i)+(I?": ":":")+o);return o=0===u.length?"{}":I?"{\n"+I+u.join(",\n"+I)+"\n"+c+"}":"{"+u.join(",")+"}",I=c,o}}("",{"":e})}},P=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var r,i="boolean"==typeof t.cycles&&t.cycles,o=t.replacer||function(e,t){return t},a=t.cmp&&(r=t.cmp,function(e){return function(t,n){var i={key:t,value:e[t]},o={key:n,value:e[n]};return r(i,o)}}),u=[];return function e(t,r,c,s){var l=n?"\n"+new Array(s+1).join(n):"",f=n?": ":":";if(c&&c.toJSON&&"function"==typeof c.toJSON&&(c=c.toJSON()),void 0!==(c=o.call(t,r,c))){if("object"!=typeof c||null===c)return U.stringify(c);if(M(c)){for(var d=[],p=0;p<c.length;p++){var h=e(c,p,c[p],s+1)||U.stringify(null);d.push(l+n+h)}return"["+d.join(",")+l+"]"}if(-1!==u.indexOf(c)){if(i)return U.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(c);var m=H(c).sort(a&&a(c));for(d=[],p=0;p<m.length;p++){var g=e(c,r=m[p],c[r],s+1);if(g){var v=U.stringify(r)+f+g;d.push(l+n+v)}}return u.splice(u.indexOf(c),1),"{"+d.join(",")+l+"}"}}({"":e},"",e,0)},M=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},H=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n};function q(e){return!!e.or}function W(e){return!!e.and}function G(e){return!!e.not}function B(e,t){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r];e.hasOwnProperty(o)&&(n[o]=e[o])}return n}function Y(e,t){for(var n=x({},e),r=0,i=t;r<i.length;r++){delete n[i[r]]}return n}var V=P;function X(e){if(g(e))return e;var t=a(e)?e:P(e);if(t.length<100)return t;for(var n=0,r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n&=n}return n}function Q(e,t){return e.indexOf(t)>-1}function K(e,t){return e.filter(function(e){return!Q(t,e)})}function J(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function Z(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function $(e){return[].concat.apply([],e)}function ee(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){e=te(e,i[r])}return e}function te(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||i(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=ee(i(t[n].constructor)?[]:{},t[n]):ee(e[n],t[n]));return e}function ne(e,t){for(var n,r=[],i={},o=0,a=e;o<a.length;o++){var u=a[o];(n=t(u))in i||(i[n]=1,r.push(u))}return r}function re(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function ie(e,t){for(var n in e)if(n in t)return!0;return!1}var oe=Object.keys;function ae(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function ue(e){return oe(e)}function ce(e){return JSON.parse(JSON.stringify(e))}function se(e){return!0===e||!1===e}function le(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function fe(e,t){return G(e)?"!("+fe(e.not,t)+")":W(e)?"("+e.and.map(function(e){return fe(e,t)}).join(") && (")+")":q(e)?"("+e.or.map(function(e){return fe(e,t)}).join(") || (")+")":t(e)}function de(e,t){if(0===t.length)return!0;var n=t.shift();return de(e[n],t)&&delete e[n],0===Object.keys(e).length}function pe(e){return e.charAt(0).toUpperCase()+e.substr(1)}function he(e,t){void 0===t&&(t="datum");for(var n=r(e),i=[],o=1;o<=n.length;o++){var a="["+n.slice(0,o).map(u).join("][")+"]";i.push(""+t+a)}return i.join(" && ")}function me(e,t){return void 0===t&&(t="datum"),t+"["+u(r(e).join("."))+"]"}function ge(e){return""+r(e).map(function(e){return e.replace(".","\\.")}).join("\\.")}function ve(e){return""+r(e).join(".")}function ye(e){return e?r(e).length:0}var be=Object.freeze({pick:B,omit:Y,stringify:V,hash:X,contains:Q,without:K,union:function(e,t){return e.concat(K(t,e))},some:J,every:Z,flatten:$,mergeDeep:ee,unique:ne,differ:re,hasIntersection:ie,isNumeric:function(e){return!isNaN(e)},differArray:function(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1},keys:oe,vals:ae,flagKeys:ue,duplicate:ce,isBoolean:se,varName:le,logicalExpr:fe,deleteNestedProperty:de,titlecase:pe,accessPathWithDatum:he,flatAccessWithDatum:me,replacePathInField:ge,removePathFromField:ve,accessPathDepth:ye}),xe={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Se=ue(xe);function Ee(e){return!!xe[e]}var we=["count","valid","missing","distinct"];function ke(e){return e&&Q(we,e)}var Ne=["count","sum","distinct","valid","missing"],Oe=["mean","average","median","q1","q3","min","max"],_e=v(Oe),Te=Object.freeze({AGGREGATE_OPS:Se,isAggregateOp:Ee,COUNTING_OPS:we,isCountingAggregateOp:ke,SUM_OPS:Ne,SHARED_DOMAIN_OPS:Oe,SHARED_DOMAIN_OP_INDEX:_e}),Ce=["domain","grid","labels","ticks","title"],Ae={grid:"grid",gridScale:"grid",domain:"main",labels:"main",labelFlush:"main",labelOverlap:"main",minExtent:"main",maxExtent:"main",offset:"main",ticks:"main",title:"main",values:"both",scale:"both",zindex:"both"},De={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},Ie=x({},De,{encoding:1,labelAngle:1,titleMaxLength:1});function ze(e){return!!Ie[e]}var Re,Le=ue(x({scale:1},De,{gridScale:1,encode:1})),Fe=ue(Ie),je=Object.freeze({AXIS_PARTS:Ce,AXIS_PROPERTY_TYPE:Ae,isAxisProperty:ze,VG_AXIS_PROPERTIES:Le,AXIS_PROPERTIES:Fe});!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.LATITUDE="latitude",e.LONGITUDE="longitude",e.LATITUDE2="latitude2",e.LONGITUDE2="longitude2",e.COLOR="color",e.FILL="fill",e.STROKE="stroke",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.KEY="key",e.TOOLTIP="tooltip",e.HREF="href"}(Re||(Re={}));var Ue=Re.X,Pe=Re.Y,Me=Re.X2,He=Re.Y2,qe=Re.LATITUDE,We=Re.LATITUDE2,Ge=Re.LONGITUDE,Be=Re.LONGITUDE2,Ye=Re.ROW,Ve=Re.COLUMN,Xe=Re.SHAPE,Qe=Re.SIZE,Ke=Re.COLOR,Je=Re.FILL,Ze=Re.STROKE,$e=Re.TEXT,et=Re.DETAIL,tt=Re.KEY,nt=Re.ORDER,rt=Re.OPACITY,it=Re.TOOLTIP,ot=Re.HREF,at={longitude:1,longitude2:1,latitude:1,latitude2:1},ut=ue(at),ct=x({x:1,y:1,x2:1,y2:1},at,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function st(e){return"color"===e||"fill"===e||"stroke"===e}var lt=x({},ct,{row:1,column:1}),ft=ue(lt),dt=(lt.order,lt.detail,ue(S(lt,["order","detail"])));function pt(e){return!!lt[e]}var ht=ue(ct),mt=(ct.x,ct.y,ct.x2,ct.y2,ct.latitude,ct.longitude,ct.latitude2,ct.longitude2,S(ct,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"])),gt=ue(mt),vt={x:1,y:1},yt=ue(vt),bt=S(mt,["text","tooltip","href","detail","key","order"]),xt=ue(bt),St=x({},vt,bt),Et=ue(St);function wt(e){return!!St[e]}function kt(e,t){return t in Nt(e)}function Nt(e){switch(e){case Ke:case Je:case Ze:case et:case tt:case it:case ot:case nt:case rt:case Ye:case Ve:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0,geoshape:!0};case Ue:case Pe:case qe:case Ge:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0};case Me:case He:case We:case Be:return{rule:!0,bar:!0,rect:!0,area:!0};case Qe:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0,trail:!0};case Xe:return{point:!0,geoshape:!0};case $e:return{text:!0}}}function Ot(e){switch(e){case Ue:case Pe:case Qe:case rt:case Me:case He:return"continuous";case Ye:case Ve:case Xe:case $e:case it:case ot:return"discrete";case Ke:case Je:case Ze:return"flexible";case qe:case Ge:case We:case Be:case et:case tt:case nt:return}throw new Error("rangeType not implemented for "+e)}var _t=Object.freeze({get Channel(){return Re},X:Ue,Y:Pe,X2:Me,Y2:He,LATITUDE:qe,LATITUDE2:We,LONGITUDE:Ge,LONGITUDE2:Be,ROW:Ye,COLUMN:Ve,SHAPE:Xe,SIZE:Qe,COLOR:Ke,FILL:Je,STROKE:Ze,TEXT:$e,DETAIL:et,KEY:tt,ORDER:nt,OPACITY:rt,TOOLTIP:it,HREF:ot,GEOPOSITION_CHANNEL_INDEX:at,GEOPOSITION_CHANNELS:ut,isColorChannel:st,CHANNELS:ft,SINGLE_DEF_CHANNELS:dt,isChannel:pt,UNIT_CHANNELS:ht,NONPOSITION_CHANNELS:gt,POSITION_SCALE_CHANNELS:yt,NONPOSITION_SCALE_CHANNELS:xt,SCALE_CHANNELS:Et,isScaleChannel:wt,supportMark:kt,getSupportedMark:Nt,rangeType:Ot});function Tt(e){return m(e)?"bin":"bin"+oe(e).map(function(t){return le("_"+t+"_"+e[t])}).join("")}function Ct(e){return e&&!m(e)}function At(e){switch(e){case Ye:case Ve:case Qe:case Ke:case Je:case Ze:case rt:case Xe:return 6;default:return 10}}var Dt,It=Object.freeze({binToString:Tt,isBinParams:Ct,autoMaxBins:At});!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.TRAIL="trail",e.CIRCLE="circle",e.SQUARE="square",e.GEOSHAPE="geoshape"}(Dt||(Dt={}));var zt=Dt.AREA,Rt=Dt.BAR,Lt=Dt.LINE,Ft=Dt.POINT,jt=Dt.TEXT,Ut=Dt.TICK,Pt=Dt.TRAIL,Mt=Dt.RECT,Ht=Dt.RULE,qt=Dt.GEOSHAPE,Wt=Dt.CIRCLE,Gt=Dt.SQUARE,Bt={area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};function Yt(e){return Q(["line","area","trail"],e)}var Vt=ue(Bt);function Xt(e){return e.type}var Qt=v(Vt);function Kt(e){return(Xt(e)?e.type:e)in Qt}var Jt,Zt,$t=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],en=["fill","fillOpacity"],tn=[].concat($t,en),nn=["filled","color"],rn={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},on={color:"#4c78a8"},an={binSpacing:1,continuousBandSize:5},un={thickness:1},cn=Object.freeze({get Mark(){return Dt},AREA:zt,BAR:Rt,LINE:Lt,POINT:Ft,TEXT:jt,TICK:Ut,TRAIL:Pt,RECT:Mt,RULE:Ht,GEOSHAPE:qt,CIRCLE:Wt,SQUARE:Gt,isMark:function(e){return!!Bt[e]},isPathMark:Yt,PRIMITIVE_MARKS:Vt,isMarkDef:Xt,isPrimitiveMark:Kt,STROKE_CONFIG:$t,FILL_CONFIG:en,FILL_STROKE_CONFIG:tn,VL_ONLY_MARK_CONFIG_PROPERTIES:nn,VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:rn,defaultMarkConfig:on,defaultBarConfig:an,defaultTickConfig:un}),sn=(Jt=d||l,{level:function(e){return arguments.length?(Jt=+e,this):Jt},error:function(){return Jt>=f&&s("error","ERROR",arguments),this},warn:function(){return Jt>=d&&s("warn","WARN",arguments),this},info:function(){return Jt>=p&&s("log","INFO",arguments),this},debug:function(){return Jt>=h&&s("log","DEBUG",arguments),this}}),ln=sn;function fn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ln.warn.apply(ln,arguments)}!function(e){e.INVALID_SPEC="Invalid spec",e.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',e.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',e.cannotProjectOnChannelWithoutField=function(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'},e.nearestNotSupportForContinuous=function(e){return'The "nearest" transform is not supported for '+e+" marks."},e.selectionNotFound=function(e){return'Cannot find a selection named "'+e+'"'},e.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",e.noSuchRepeatedValue=function(e){return'Unknown repeated value "'+e+'".'},e.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",e.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",e.cannotSetTitleAnchor=function(e){return'Cannot set title "anchor" for a '+e+" spec"},e.unrecognizedParse=function(e){return'Unrecognized parse "'+e+'".'},e.differentParse=function(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."},e.invalidTransformIgnored=function(e){return"Ignoring an invalid transform: "+V(e)+"."},e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',e.encodingOverridden=function(e){return"Layer's shared "+e.join(",")+" channel "+(1===e.length?"is":"are")+" overriden"},e.projectionOverridden=function(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+V(t)+" is overridden by a child projection "+V(n)+"."},e.primitiveChannelDef=function(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+V(n)+"}."},e.invalidFieldType=function(e){return'Invalid field type "'+e+'"'},e.nonZeroScaleUsedWithLengthMark=function(e,t,n){return"A "+(n.scaleType?n.scaleType+" scale":n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero")+" is used to encode "+e+"'s "+t+". This can be misleading as the "+("x"===t?"width":"height")+" of the "+e+" can be arbitrary based on the scale domain. You may want to use point mark instead."},e.invalidFieldTypeForCountAggregate=function(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'},e.invalidAggregate=function(e){return'Invalid aggregation operator "'+e+'"'},e.emptyOrInvalidFieldType=function(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'},e.droppingColor=function(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")},e.emptyFieldDef=function(e,t){return"Dropping "+V(e)+' from channel "'+t+'" since it does not contain data field or value.'},e.latLongDeprecated=function(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."},e.LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",e.incompatibleChannel=function(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."},e.invalidEncodingChannel=function(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."},e.facetChannelShouldBeDiscrete=function(e){return e+" encoding should be discrete (ordinal / nominal / binned)."},e.discreteChannelCannotEncode=function(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."},e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.lineWithRange=function(e,t){return"Line mark is for continuous lines and thus cannot be used with "+(e&&t?"x2 and y2":e?"x2":"y2")+". We will use the rule mark (line segments) instead."},e.orientOverridden=function(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'},e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=function(e){return'Cannot use the scale property "'+e+'" with non-color channel.'},e.unaggregateDomainHasNoEffectForRawField=function(e){return"Using unaggregated domain with raw field has no effect ("+V(e)+")."},e.unaggregateDomainWithNonSharedDomainOp=function(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'},e.unaggregatedDomainWithLogScale=function(e){return"Unaggregated domain is currently unsupported for log scale ("+V(e)+")."},e.cannotApplySizeToNonOrientedMark=function(e){return'Cannot apply size to non-oriented mark "'+e+'".'},e.rangeStepDropped=function(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."},e.scaleTypeNotWorkWithChannel=function(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'},e.scaleTypeNotWorkWithFieldDef=function(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'},e.scalePropertyNotWorkWithScaleType=function(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."},e.scaleTypeNotWorkWithMark=function(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'},e.mergeConflictingProperty=function(e,t,n,r){return"Conflicting "+t.toString()+' property "'+e.toString()+'" ('+V(n)+" and "+V(r)+").  Using "+V(n)+"."},e.independentScaleMeansIndependentGuide=function(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'},e.domainSortDropped=function(e){return"Dropping sort property "+V(e)+" as unioned domains only support boolean or op 'count'."},e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=function(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'},e.cannotStackNonLinearScale=function(e){return"Cannot stack non-linear scale ("+e+")"},e.stackNonSummativeAggregate=function(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'},e.invalidTimeUnit=function(e,t){return"Invalid "+e+": "+V(t)},e.dayReplacedWithDate=function(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."},e.droppedDay=function(e){return"Dropping day from datetime "+V(e)+" as day cannot be combined with other units."}}(Zt||(Zt={}));var dn=2006;function pn(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}var hn=["january","february","march","april","may","june","july","august","september","october","november","december"],mn=hn.map(function(e){return e.substr(0,3)}),gn=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],vn=gn.map(function(e){return e.substr(0,3)});function yn(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&oe(e).length>1&&(fn(Zt.droppedDay(e)),delete(e=ce(e)).day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(dn):n.push(0),void 0!==e.month){var r=t?function(e){if(g(e))return e-1+"";var t=e.toLowerCase(),n=hn.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=mn.indexOf(r);if(-1!==i)return i+"";throw new Error(Zt.invalidTimeUnit("month",e))}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var i=t?function(e){if(g(e))return e>4&&fn(Zt.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(Zt.invalidTimeUnit("quarter",e))}(e.quarter):e.quarter;n.push(i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var o=t?function(e){if(g(e))return e%7+"";var t=e.toLowerCase(),n=gn.indexOf(t);if(-1!==n)return n+"";var r=t.substr(0,3),i=vn.indexOf(r);if(-1!==i)return i+"";throw new Error(Zt.invalidTimeUnit("day",e))}(e.day):e.day;n.push(o+"+1")}else n.push(1);for(var a=0,u=["hours","minutes","seconds","milliseconds"];a<u.length;a++){var c=u[a];void 0!==e[c]?n.push(e[c]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}var bn,xn=Object.freeze({isDateTime:pn,MONTHS:hn,SHORT_MONTHS:mn,DAYS:gn,SHORT_DAYS:vn,dateTimeExpr:yn});!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(bn||(bn={}));var Sn={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},En=ue(Sn);function wn(e){return!!Sn[e]}var kn={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};function Nn(e){return!!kn[e]}var On={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},_n=x({},kn,On);function Tn(e){return!!_n[e]}function Cn(e){return e.substr(3)}var An=x({},Sn,kn,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},On),Dn=ue(An);var In={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function zn(e,t){var n=In[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function Rn(e){return En.reduce(function(t,n){return Ln(e,n)?t.concat(n):t},[])}function Ln(e,t){var n=e.indexOf(t);return n>-1&&(t!==bn.SECONDS||0===n||"i"!==e.charAt(n-1))}function Fn(e,t){var n=he(t),r=Tn(e)?"utc":"";return yn(En.reduce(function(t,i){var o;return Ln(e,i)&&(t[i]=(o=i)===bn.QUARTER?"("+r+"quarter("+n+")-1)":""+r+o+"("+n+")"),t},{}))}function jn(e,t,n,r){if(e){var i=[],o="",a=Ln(e,bn.YEAR);Ln(e,bn.QUARTER)&&(o="'Q' + quarter("+t+")"),Ln(e,bn.MONTH)&&i.push(!1!==n?"%b":"%B"),Ln(e,bn.DAY)?i.push(n?"%a":"%A"):Ln(e,bn.DATE)&&i.push("%d"+(a?",":"")),a&&i.push(n?"%y":"%Y");var u=[];Ln(e,bn.HOURS)&&u.push("%H"),Ln(e,bn.MINUTES)&&u.push("%M"),Ln(e,bn.SECONDS)&&u.push("%S"),Ln(e,bn.MILLISECONDS)&&u.push("%L");var c=[];return i.length>0&&c.push(i.join(" ")),u.length>0&&c.push(u.join(":")),c.length>0&&(o&&(o+=" + ' ' + "),o+=r?"utcFormat("+t+", '"+c.join(" ")+"')":"timeFormat("+t+", '"+c.join(" ")+"')"),o||void 0}}function Un(e){return"day"!==e&&e.indexOf("day")>=0?(fn(Zt.dayReplacedWithDate(e)),e.replace("day","date")):e}var Pn,Mn=Object.freeze({get TimeUnit(){return bn},TIMEUNIT_PARTS:En,isLocalSingleTimeUnit:wn,isUtcSingleTimeUnit:Nn,isUTCTimeUnit:Tn,getLocalTimeUnit:Cn,TIMEUNITS:Dn,isTimeUnit:function(e){return!!An[e]},convert:function(e,t){for(var n=Tn(e),r=n?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),i=0,o=En;i<o.length;i++){var a=o[i];if(Ln(e,a))switch(a){case bn.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case bn.QUARTER:var u=zn("month",n),c=u.getDateMethod;r[u.setDateMethod](3*Math.floor(t[c]()/3));break;default:var s=zn(a,n),l=s.getDateMethod;r[s.setDateMethod](t[l]())}}return r},getTimeUnitParts:Rn,containsTimeUnit:Ln,fieldExpr:Fn,formatExpression:jn,normalizeTimeUnit:Un});!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal",e.LATITUDE="latitude",e.LONGITUDE="longitude",e.GEOJSON="geojson"}(Pn||(Pn={}));var Hn={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};var qn=Pn.QUANTITATIVE,Wn=Pn.ORDINAL,Gn=Pn.TEMPORAL,Bn=Pn.NOMINAL,Yn=Pn.GEOJSON;function Vn(e){if(e)switch(e=e.toLowerCase()){case"q":case qn:return"quantitative";case"t":case Gn:return"temporal";case"o":case Wn:return"ordinal";case"n":case Bn:return"nominal";case Pn.LATITUDE:return"latitude";case Pn.LONGITUDE:return"longitude";case Yn:return"geojson"}}var Xn=Object.freeze({get Type(){return Pn},TYPE_INDEX:Hn,isType:function(e){return!!Hn[e]},QUANTITATIVE:qn,ORDINAL:Wn,TEMPORAL:Gn,NOMINAL:Bn,GEOJSON:Yn,getFullName:Vn});function Qn(e){return e.selection}function Kn(e){return e&&!a(e)&&"repeat"in e}function Jn(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return x({},n?{timeUnit:n}:{},r?{bin:r}:{},i?{aggregate:i}:{},{field:t})}function Zn(e){return!!e&&!!e.condition}function $n(e){return!!e&&!!e.condition&&!i(e.condition)&&tr(e.condition)}function er(e){return!!e&&!!e.condition&&(i(e.condition)||rr(e.condition))}function tr(e){return!(!e||!e.field&&"count"!==e.aggregate)}function nr(e){return tr(e)&&a(e.field)}function rr(e){return e&&"value"in e&&void 0!==e.value}function ir(e){return!(!e||!e.scale&&!e.sort)}function or(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(cr(e))n="count_*";else{var o=void 0;t.nofn||(!function(e){return!!e.op}(e)?e.bin?(o=Tt(e.bin),i=t.binSuffix||""):e.aggregate?o=String(e.aggregate):e.timeUnit&&(o=String(e.timeUnit)):o=e.op),o&&(n=n?o+"_"+n:o)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr?me(n,t.expr):ge(n)}function ar(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return!1}throw new Error(Zt.invalidFieldType(e.type))}function ur(e){return!ar(e)}function cr(e){return"count"===e.aggregate}function sr(e,t){var n=e.field,r=e.bin,i=e.timeUnit,o=e.aggregate;return"count"===o?t.countTitle:r?n+" (binned)":i?n+" ("+Rn(i).join("-")+")":o?pe(o)+" of "+n:n}function lr(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}var fr=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return lr(e);default:return sr(e,t)}},dr=fr;function pr(e){dr=e}function hr(){pr(fr)}function mr(e,t){return dr(e,t)}function gr(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(Ot(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}function vr(e){return tr(e)?e:$n(e)?e.condition:void 0}function yr(e,t){if(a(e)||g(e)||m(e)){var n=a(e)?"string":g(e)?"number":"boolean";return fn(Zt.primitiveChannelDef(t,n,e)),{value:e}}return tr(e)?br(e,t):$n(e)?x({},e,{condition:br(e.condition,t)}):e}function br(e,t){if(e.aggregate&&!Ee(e.aggregate)){e.aggregate;var n=S(e,["aggregate"]);fn(Zt.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=x({},e,{timeUnit:Un(e.timeUnit)})),e.bin&&(e=x({},e,{bin:xr(e.bin,t)})),e.type){var r=Vn(e.type);e.type!==r&&(e=x({},e,{type:r})),"quantitative"!==e.type&&ke(e.aggregate)&&(fn(Zt.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=x({},e,{type:"quantitative"}))}else{var i=gr(e,t);fn(Zt.emptyOrInvalidFieldType(e.type,t,i)),e=x({},e,{type:i})}var o=Er(e,t),a=o.compatible,u=o.warning;return a||fn(u),e}function xr(e,t){return m(e)?{maxbins:At(t)}:e.maxbins||e.step?e:x({},e,{maxbins:At(t)})}var Sr={compatible:!0};function Er(e,t){var n=e.type;switch(t){case"row":case"column":return ur(e)?{compatible:!1,warning:Zt.facetChannelShouldBeDiscrete(t)}:Sr;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return Sr;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==qn?{compatible:!1,warning:"Channel "+t+" should be used with a quantitative field only, not "+e.type+" field."}:Sr;case"opacity":case"size":case"x2":case"y2":return"nominal"===n&&!e.sort||"geojson"===n?{compatible:!1,warning:"Channel "+t+" should not be used with an unsorted discrete field."}:Sr;case"shape":return"nominal"!==e.type&&"geojson"!==e.type?{compatible:!1,warning:"Shape channel should be used with only either nominal or geojson data"}:Sr;case"order":return"nominal"!==e.type||"sort"in e?Sr:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}throw new Error("channelCompatability not implemented for channel "+t)}function wr(e){return"quantitative"===e.type||!!e.bin}function kr(e){return"temporal"===e.type||!!e.timeUnit}function Nr(e,t){var n,r=t.timeUnit,i=t.type,o=t.time,u=t.undefinedIfExprNotRequired,c=void 0;return pn(e)?c=yn(e,!0):(a(e)||g(e))&&(r||"temporal"===i)&&(c=wn(r)?yn(((n={})[r]=e,n),!0):Nn(r)?Nr(e,{timeUnit:Cn(r)}):"datetime("+JSON.stringify(e)+")"),c?o?"time("+c+")":c:u?void 0:JSON.stringify(e)}function Or(e,t){var n=e.timeUnit,r=e.type;return t.map(function(e){var t=Nr(e,{timeUnit:n,type:r,undefinedIfExprNotRequired:!0});return void 0!==t?{signal:t}:e})}var _r=Object.freeze({isConditionalSelection:Qn,isRepeatRef:Kn,toFieldDefBase:Jn,isConditionalDef:Zn,hasConditionalFieldDef:$n,hasConditionalValueDef:er,isFieldDef:tr,isStringFieldDef:nr,isValueDef:rr,isScaleFieldDef:ir,vgField:or,isDiscrete:ar,isContinuous:ur,isCount:cr,verbalTitleFormatter:sr,functionalTitleFormatter:lr,defaultTitleFormatter:fr,setTitleFormatter:pr,resetTitleFormatter:hr,title:mr,defaultType:gr,getFieldDef:vr,normalize:yr,normalizeFieldDef:br,normalizeBin:xr,channelCompatibility:Er,isNumberFieldDef:wr,isTimeFieldDef:kr,valueExpr:Nr,valueArray:Or});function Tr(e,t){var n=e&&e[t];return!!n&&(i(n)?J(n,function(e){return!!e.field}):tr(n)||$n(n))}function Cr(e){return J(ft,function(t){if(Tr(e,t)){var n=e[t];if(i(n))return J(n,function(e){return!!e.aggregate});var r=vr(n);return r&&!!r.aggregate}return!1})}function Ar(e,t){return oe(e).reduce(function(n,r){var o;if(!pt(r))return fn(Zt.invalidEncodingChannel(r)),n;if(!kt(r,t))return fn(Zt.incompatibleChannel(r,t)),n;if("size"===r&&"line"===t&&((u=vr(e[r]))&&u.aggregate))return fn(Zt.LINE_WITH_VARYING_SIZE),n;if("color"===r&&("fill"in e||"stroke"in e))return fn(Zt.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),n;var a=e[r];if("detail"===r||"order"===r&&!i(a)&&!rr(a)||"tooltip"===r&&i(a))a&&(n[r]=(i(a)?a:[a]).reduce(function(e,t){return tr(t)?e.push(br(t,r)):fn(Zt.emptyFieldDef(t,r)),e},[]));else{var u;if((u=vr(e[r]))&&Q([Pn.LATITUDE,Pn.LONGITUDE],u.type)){var c=r,s=(n[c],S(n,["symbol"==typeof c?c:c+""])),l="x"===r?"longitude":"y"===r?"latitude":"x2"===r?"longitude2":"y2"===r?"latitude2":void 0;return fn(Zt.latLongDeprecated(r,u.type,l)),x({},s,((o={})[l]=x({},yr(u,r),{type:"quantitative"}),o))}if(!tr(a)&&!rr(a)&&!Zn(a))return fn(Zt.emptyFieldDef(a,r)),n;n[r]=yr(a,r)}return n},{})}function Dr(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function Ir(e){var t=[];return ft.forEach(function(n){if(Tr(e,n)){var r=e[n];(i(r)?r:[r]).forEach(function(e){tr(e)?t.push(e):$n(e)&&t.push(e.condition)})}}),t}function zr(e,t,n){if(e)for(var r=function(r){i(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)},o=0,a=oe(e);o<a.length;o++){r(a[o])}}function Rr(e,t,n,r){return e?oe(e).reduce(function(n,o){var a=e[o];return i(a)?a.reduce(function(e,n){return t.call(r,e,n,o)},n):t.call(r,n,a,o)},n):n}var Lr=Object.freeze({channelHasField:Tr,isAggregate:Cr,normalizeEncoding:Ar,isRanged:Dr,fieldDefs:Ir,forEach:zr,reduce:Rr});function Fr(e,t){var n,r=e[t];return void 0!==r?((n={})[t]={value:r},n):{}}var jr="box-plot";function Ur(e){return!!e.type}var Pr=["x","y","color","detail","opacity","size"];var Mr={};function Hr(e,t){Mr[e]=t}var qr=["boxWhisker","box","boxMid"],Wr=x({},{box:["size","color","extent"],boxWhisker:["color"],boxMid:["color"]});function Gr(e,t){var n=Xt(e.mark)?e.mark.type:e.mark,r=Mr[n];if(r)return r(e,t);throw new Error('Invalid mark type "'+n+'"')}Hr(jr,function(e,t){var n,r,i,o,a=(e=function(e){return x({},e,{encoding:Rr(e.encoding,function(e,t,n){return Pr.indexOf(n)>-1?e[n]=t:fn(Zt.incompatibleChannel(n,jr)),e},{})})}(e)).mark,u=(e.encoding,e.selection),c=(e.projection,S(e,["mark","encoding","selection","projection"])),s=void 0;g(t.box.extent)&&(s=t.box.extent),Ur(a)&&a.extent&&"min-max"===a.extent&&(s=void 0);var l=function(e,t,n){var r=function(e,t){e.mark;var n,r,i=e.encoding;if(e.projection,S(e,["mark","encoding","projection"]),"vertical"===t?(r="y",n=i.y):(r="x",n=i.x),n&&n.aggregate){var o=n.aggregate,a=S(n,["aggregate"]);o!==jr&&fn("Continuous axis should not have customized aggregation function "+o),n=a}return{continuousAxisChannelDef:n,continuousAxis:r}}(e,t),i=r.continuousAxisChannelDef,o=r.continuousAxis,a=e.encoding,u=void 0===n,c=[{op:"q1",field:i.field,as:"lower_box_"+i.field},{op:"q3",field:i.field,as:"upper_box_"+i.field},{op:"median",field:i.field,as:"mid_box_"+i.field}],s=[];c.push({op:"min",field:i.field,as:(u?"lower_whisker_":"min_")+i.field}),c.push({op:"max",field:i.field,as:(u?"upper_whisker_":"max_")+i.field}),u||(s=[{calculate:"datum.upper_box_"+i.field+" - datum.lower_box_"+i.field,as:"iqr_"+i.field},{calculate:"min(datum.upper_box_"+i.field+" + datum.iqr_"+i.field+" * "+n+", datum.max_"+i.field+")",as:"upper_whisker_"+i.field},{calculate:"max(datum.lower_box_"+i.field+" - datum.iqr_"+i.field+" * "+n+", datum.min_"+i.field+")",as:"lower_whisker_"+i.field}]);var l=[],f=[],d=[],p={};return zr(a,function(e,t){if(t!==o)if(tr(e)){if(e.aggregate&&e.aggregate!==jr)c.push({op:e.aggregate,field:e.field,as:or(e)});else if(void 0===e.aggregate){var n=or(e),r=e.bin;if(r){var i=e.field;f.push({bin:r,field:i,as:n})}else if(e.timeUnit){var u=e.timeUnit;i=e.field,d.push({timeUnit:u,field:i,as:n})}l.push(n)}p[t]={field:or(e),type:e.type}}else p[t]=a[t]}),{transform:[].concat(f,d,[{aggregate:c,groupby:l}],s),continuousAxisChannelDef:i,continuousAxis:o,encodingWithoutContinuousAxis:p}}(e,function(e){var t=e.mark,n=e.encoding;if(e.projection,S(e,["mark","encoding","projection"]),tr(n.x)&&ur(n.x)){if(tr(n.y)&&ur(n.y)){if(void 0===n.x.aggregate&&n.y.aggregate===jr)return"vertical";if(void 0===n.y.aggregate&&n.x.aggregate===jr)return"horizontal";if(n.x.aggregate===jr&&n.y.aggregate===jr)throw new Error("Both x and y cannot have aggregate");return Ur(t)&&t.orient?t.orient:"vertical"}return"horizontal"}if(tr(n.y)&&ur(n.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}(e),s),f=l.transform,d=l.continuousAxisChannelDef,p=l.continuousAxis,h=l.encodingWithoutContinuousAxis,m=h.size,v=S(h,["color","size"]),y=m?{size:m}:Fr(t.box,"size"),b={};return d.scale&&(b.scale=d.scale),d.axis&&(b.axis=d.axis),x({},c,{transform:f,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:x((n={},n[p]=x({field:"lower_whisker_"+d.field,type:d.type},b),n[p+"2"]={field:"lower_box_"+d.field,type:d.type},n),v,Fr(t.boxWhisker,"color"))},{mark:{type:"rule",style:"boxWhisker"},encoding:x((r={},r[p]={field:"upper_box_"+d.field,type:d.type},r[p+"2"]={field:"upper_whisker_"+d.field,type:d.type},r),v,Fr(t.boxWhisker,"color"))},x({},u?{selection:u}:{},{mark:{type:"bar",style:"box"},encoding:x((i={},i[p]={field:"lower_box_"+d.field,type:d.type},i[p+"2"]={field:"upper_box_"+d.field,type:d.type},i),h,h.color?{}:Fr(t.box,"color"),y)}),{mark:{type:"tick",style:"boxMid"},encoding:x((o={},o[p]={field:"mid_box_"+d.field,type:d.type},o),v,Fr(t.boxMid,"color"),y)}]})}),Hr("error-bar",function(e){e.mark,e.selection,e.projection;var t=e.encoding,n=S(e,["mark","selection","projection","encoding"]),r=(t.size,S(t,["size"])),i=(t.x2,t.y2,S(t,["x2","y2"])),o=S(i,["x","y"]);if(!t.x2&&!t.y2)throw new Error("Neither x2 or y2 provided");return x({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:i},{mark:"tick",encoding:t.x2?x({x:t.x2,y:t.y},o):x({x:t.x,y:t.y2},o)}]})});var Br,Yr=Object.freeze({add:Hr,remove:function(e){delete Mr[e]},COMPOSITE_MARK_STYLES:qr,VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:Wr,normalize:Gr}),Vr=["shortTimeLabels"],Xr={},Qr={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},Kr=x({},Qr,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1}),Jr=ue(Qr),Zr=ue(Kr),$r=Object.freeze({defaultLegendConfig:Xr,LEGEND_PROPERTIES:Jr,VG_LEGEND_PROPERTIES:Zr});!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(Br||(Br={}));var ei={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"},ti=oe(ei);function ni(e,t){var n=ei[e],r=ei[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}var ri={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};function ii(e){return ri[e]}var oi=["linear","bin-linear","log","pow","sqrt","time","utc"],ai=v(oi),ui=oi.concat(["sequential"]),ci=v(ui),si=["ordinal","bin-ordinal","point","band"],li=v(si),fi=v(["bin-linear","bin-ordinal"]);function di(e){return e in li}function pi(e){return e in fi}function hi(e){return e in ci}function mi(e){return e in ai}var gi={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4};function vi(e){return e&&!!e.name}function yi(e){return e&&e.selection}var bi={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},xi=ue(bi),Si=ue(S(bi,["type","domain","range","rangeStep","scheme"])),Ei=function(){for(var e={},t=0,n=ft;t<n.length;t++)for(var r=n[t],i=0,o=oe(Hn);i<o.length;i++)for(var a=o[i],u=0,c=ti;u<c.length;u++)for(var s=c[u],l=0,f=[!1,!0];l<f.length;l++){var d=f[l],p=_i(r,a,d);Oi(r,s)&&Ni(s,a,d)&&(e[p]=e[p]||[],e[p].push(s))}return e}();function wi(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return Q(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return Q(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return mi(e)||"band"===e||"point"===e;case"padding":return mi(e)||Q(["point","band"],e);case"paddingOuter":case"rangeStep":return Q(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return mi(e)||"sequential"===e;case"nice":return mi(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return hi(e)&&!Q(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function ki(e,t){switch(t){case"interpolate":case"scheme":return st(e)?void 0:Zt.cannotUseScalePropertyWithNonColor(e);case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')}function Ni(e,t,n){return Q([Pn.ORDINAL,Pn.NOMINAL],t)?void 0===e||di(e):t===Pn.TEMPORAL?Q([Br.TIME,Br.UTC,Br.SEQUENTIAL,void 0],e):t!==Pn.QUANTITATIVE||Q(n?[Br.BIN_LINEAR,Br.BIN_ORDINAL,Br.LINEAR]:[Br.LOG,Br.POW,Br.SQRT,Br.QUANTILE,Br.QUANTIZE,Br.LINEAR,Br.SEQUENTIAL,void 0],e)}function Oi(e,t){switch(e){case Re.X:case Re.Y:case Re.SIZE:case Re.OPACITY:return mi(t)||Q(["band","point"],t);case Re.COLOR:case Re.FILL:case Re.STROKE:return"band"!==t;case Re.SHAPE:return"ordinal"===t}return!1}function _i(e,t,n){var r=e+"_"+t;return n?r+"_bin":r}var Ti=Object.freeze({get ScaleType(){return Br},SCALE_TYPES:ti,scaleCompatible:ni,scaleTypePrecedence:ii,CONTINUOUS_TO_CONTINUOUS_SCALES:oi,CONTINUOUS_DOMAIN_SCALES:ui,DISCRETE_DOMAIN_SCALES:si,TIME_SCALE_TYPES:["time","utc"],hasDiscreteDomain:di,isBinScale:pi,hasContinuousDomain:hi,isContinuousToContinuous:mi,defaultScaleConfig:gi,isExtendedScheme:vi,isSelectionDomain:yi,SCALE_PROPERTIES:xi,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES:Si,SCALE_TYPE_INDEX:Ei,scaleTypeSupportProperty:wi,channelScalePropertyIncompatability:ki,scaleTypeSupportDataType:Ni,channelSupportScaleType:Oi,getSupportedScaleType:function(e,t,n){return Ei[_i(e,t,n)]}}),Ci="_vgsid_";function Ai(e){var t=e.anchor,n=e.offset,r=e.orient,i=e.color,o=S(e,["anchor","offset","orient","color"]);return{mark:x({},o,i?{fill:i}:{}),nonMark:x({},t?{anchor:t}:{},n?{offset:n}:{},r?{orient:r}:{})}}var Di={width:200,height:200},Ii={padding:5,timeFormat:"",countTitle:"Number of Records",invalidValues:"filter",view:Di,mark:on,area:{},bar:an,circle:{},geoshape:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:un,trail:{},box:{size:14,extent:1.5},boxWhisker:{},boxMid:{color:"white"},scale:gi,projection:{},axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:Xr,selection:{single:{on:"click",fields:[Ci],resolve:"global",empty:"all"},multi:{on:"click",fields:[Ci],toggle:"event.shiftKey",resolve:"global",empty:"all"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}},style:{},title:{}};function zi(e){return ee(ce(Ii),e)}var Ri=["view"].concat(Vt,qr),Li=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],Fi=x({view:["width","height"]},rn,Wr);function ji(e){e=ce(e);for(var t=0,n=Li;t<n.length;t++){delete e[a=n[t]]}if(e.axis)for(var r=0,i=Vr;r<i.length;r++){var a=i[r];delete e.axis[a]}if(e.legend)for(var u=0,c=Vr;u<c.length;u++){a=c[u];delete e.legend[a]}if(e.mark)for(var s=0,l=nn;s<l.length;s++){a=l[s];delete e.mark[a]}for(var f=0,d=Ri;f<d.length;f++){for(var p=d[f],h=0,m=nn;h<m.length;h++){a=m[h];delete e[p][a]}var g=Fi[p];if(g)for(var v=0,y=g;v<y.length;v++){a=y[v];delete e[p][a]}Ui(e,p)}for(var a in Ui(e,"title","group-title"),e)o(e[a])&&0===oe(e[a]).length&&delete e[a];return oe(e).length>0?e:void 0}function Ui(e,t,n){var r="title"===t?Ai(e.title).mark:e[t];"view"===t&&(n="cell");var i=x({},r,e.style[t]);oe(i).length>0&&(e.style[n||t]=i),delete e[t]}var Pi=Object.freeze({defaultViewConfig:Di,defaultConfig:Ii,initConfig:zi,stripAndRedirectConfig:ji}),Mi={zero:1,center:1,normalize:1};function Hi(e){return!!Mi[e]}var qi=[Rt,zt,Ht,Ft,Wt,Gt,Lt,jt,Ut],Wi=[Rt,zt];function Gi(e,t,n){var r=Xt(e)?e.type:e;if(!Q(qi,r))return null;var o=function(e){var t=e.x,n=e.y;if(tr(t)&&tr(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(tr(t)&&"quantitative"===t.type)return"x";if(tr(n)&&"quantitative"===n.type)return"y"}}(t);if(!o)return null;var a=t[o],u=nr(a)?or(a,{}):void 0,c="x"===o?"y":"x",s=t[c],l=nr(s)?or(s,{}):void 0,f=gt.reduce(function(e,n){if(Tr(t,n)){var r=t[n];(i(r)?r:[r]).forEach(function(t){var r=vr(t);if(!r.aggregate){var i=nr(r)?or(r,{}):void 0;(!i||i!==l&&i!==u)&&e.push({channel:n,fieldDef:r})}})}return e},[]);if(0===f.length)return null;var d=void 0;return(d=void 0!==a.stack?a.stack:Q(Wi,r)&&void 0===n?"zero":n)&&Hi(d)?(a.scale&&a.scale.type&&a.scale.type!==Br.LINEAR&&fn(Zt.cannotStackNonLinearScale(a.scale.type)),Tr(t,o===Ue?Me:He)?(void 0!==a.stack&&fn(Zt.cannotStackRangedMark(o)),null):(a.aggregate&&!Q(Ne,a.aggregate)&&fn(Zt.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:s?c:void 0,fieldChannel:o,impute:Yt(r),stackBy:f,offset:d})):null}var Bi=Object.freeze({isStackOffset:Hi,STACKABLE_MARKS:qi,STACK_BY_DEFAULT_MARKS:Wi,stack:Gi});function Yi(e){return void 0!==e.facet}function Vi(e){return!!e.mark}function Xi(e){return void 0!==e.layer}function Qi(e){return void 0!==e.repeat}function Ki(e){return Ji(e)||Zi(e)}function Ji(e){return void 0!==e.vconcat}function Zi(e){return void 0!==e.hconcat}function $i(e,t){if(Yi(e))return function(e,t){var n=e.spec,r=S(e,["spec"]);return x({},r,{spec:$i(n,t)})}(e,t);if(Xi(e))return function e(t,n,r,i){var o=t.layer,a=t.encoding,u=t.projection,c=S(t,["layer","encoding","projection"]);var s=eo({parentEncoding:r,encoding:a});var l=to({parentProjection:i,projection:u});return x({},c,{layer:o.map(function(t){return Xi(t)?e(t,n,s,l):no(t,n,s,l)})})}(e,t);if(Qi(e))return function(e,t){var n=e.spec,r=S(e,["spec"]);return x({},r,{spec:$i(n,t)})}(e,t);if(Ji(e))return function(e,t){var n=e.vconcat,r=S(e,["vconcat"]);return x({},r,{vconcat:n.map(function(e){return $i(e,t)})})}(e,t);if(Zi(e))return function(e,t){var n=e.hconcat,r=S(e,["hconcat"]);return x({},r,{hconcat:n.map(function(e){return $i(e,t)})})}(e,t);if(Vi(e)){var n=Tr(e.encoding,Ye),r=Tr(e.encoding,Ve);return n||r?function(e,t){var n=e.encoding,r=n.row,i=n.column,o=S(n,["row","column"]),a=e.mark,u=e.width,c=e.projection,s=e.height,l=e.selection,f=(e.encoding,S(e,["mark","width","projection","height","selection","encoding"]));return x({},f,{facet:x({},r?{row:r}:{},i?{column:i}:{}),spec:no(x({},c?{projection:c}:{},{mark:a},u?{width:u}:{},s?{height:s}:{},{encoding:o},l?{selection:l}:{}),t)})}(e,t):no(e,t)}throw new Error(Zt.INVALID_SPEC)}function eo(e){var t=e.parentEncoding,n=e.encoding;if(t&&n){var r=oe(t).reduce(function(e,t){return n[t]&&e.push(t),e},[]);r.length>0&&fn(Zt.encodingOverridden(r))}var i=x({},t||{},n||{});return oe(i).length>0?i:void 0}function to(e){var t=e.parentProjection,n=e.projection;return t&&n&&fn(Zt.projectionOverridden({parentProjection:t,projection:n})),n||t}function no(e,t,n,r){var i=e.encoding,a=e.projection,u=Xt(e.mark)?e.mark.type:e.mark;if(n||r){var c=to({parentProjection:r,projection:a}),s=eo({parentEncoding:n,encoding:i});return no(x({},e,c?{projection:c}:{},s?{encoding:s}:{}),t)}return function(e){return Kt(e.mark)}(e)?Dr(i)?function(e){var t=Tr(e.encoding,Ue),n=Tr(e.encoding,Pe),r=Tr(e.encoding,Me),i=Tr(e.encoding,He);if(r&&!t||i&&!n){var o=ce(e);return r&&!t&&(o.encoding.x=o.encoding.x2,delete o.encoding.x2),i&&!n&&(o.encoding.y=o.encoding.y2,delete o.encoding.y2),o}return e}(e):"line"===u&&(i.x2||i.y2)?(fn(Zt.lineWithRange(!!i.x2,!!i.y2)),no(x({mark:"rule"},e),t,n,r)):Yt(u)?function(e,t){void 0===t&&(t={});var n,r=e.selection,i=e.projection,a=e.encoding,u=e.mark,c=S(e,["selection","projection","encoding","mark"]),s=Xt(u)?u:{type:u},l=function(e,t,n){return"transparent"===e.point?{opacity:0}:e.point?o(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?o(t.point)?t.point:{}:null}(s,t[s.type],a),f="area"===s.type&&function(e,t){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:null}(s,t[s.type]);if(!l&&!f)return x({},e,{mark:ro(s)});var d=[x({},r?{selection:r}:{},{mark:ro(x({},s,"area"===s.type?{opacity:.7}:{})),encoding:Y(a,["shape"])})],p=Gi(s,a,t?t.stack:void 0),h=a;if(p){var m=p.fieldChannel,g=p.offset;h=x({},a,((n={})[m]=x({},a[m],g?{stack:g}:{}),n))}f&&d.push(x({},i?{projection:i}:{},{mark:x({type:"line"},B(s,["clip","interpolate"]),f),encoding:h}));l&&d.push(x({},i?{projection:i}:{},{mark:x({type:"point",opacity:1,filled:!0},B(s,["clip"]),l),encoding:h}));return x({},c,{layer:d})}(e,t):e:Gr(e,t)}function ro(e){e.point,e.line;var t=S(e,["point","line"]);return oe(t).length>1?t:t.type}function io(e,t){return t.forEach(function(t){var n=X(["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}));e[n]=e[n]||t}),e}var oo=Object.freeze({isFacetSpec:Yi,isUnitSpec:Vi,isLayerSpec:Xi,isRepeatSpec:Qi,isConcatSpec:Ki,isVConcatSpec:Ji,isHConcatSpec:Zi,normalize:$i,fieldDefs:function(e){return ae(function e(t,n){return void 0===n&&(n={}),Xi(t)?t.layer.forEach(function(t){Vi(t)?io(n,Ir(t.encoding)):e(t,n)}):Yi(t)?(io(n,Ir(t.facet)),e(t.spec,n)):Qi(t)?e(t.spec,n):Ki(t)?(Ji(t)?t.vconcat:t.hconcat).forEach(function(t){return e(t,n)}):io(n,Ir(t.encoding)),n}(e))},isStacked:function(e,t){return t=t||e.config,!!Kt(e.mark)&&null!==Gi(e.mark,e.encoding,t?t.stack:void 0)}});function ao(e){return a(e)?{type:e}:e||{}}var uo=["background","padding","datasets"];function co(e){return uo.reduce(function(t,n){return e&&void 0!==e[n]&&(t[n]=e[n]),t},{})}function so(e){return!!e.url}function lo(e){return!!e.values}function fo(e){return!!e.name&&!so(e)&&!lo(e)}var po="main",ho="raw",mo=Object.freeze({isUrlData:so,isInlineData:lo,isNamedData:fo,MAIN:po,RAW:ho});function go(e,t,n){return vo=t||bo,yo=n||Co,Do(e.trim()).map(Io)}var vo,yo,bo="view",xo="[",So="]",Eo="{",wo="}",ko=":",No=",",Oo="@",_o=">",To=/[[\]{}]/,Co={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Ao(e,t,n,r,i){for(var o,a=0,u=e.length;t<u;++t){if(o=e[t],!a&&o===n)return t;i&&i.indexOf(o)>=0?--a:r&&r.indexOf(o)>=0&&++a}return t}function Do(e){for(var t=[],n=0,r=e.length,i=0;i<r;)i=Ao(e,i,No,xo+Eo,So+wo),t.push(e.substring(n,i).trim()),n=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function Io(e){return"["===e[0]?function(e){var t,n,r=e.length,i=1;if((i=Ao(e,i,So,xo,So))===r)throw"Empty between selector: "+e;if(2!==(t=Do(e.substring(1,i))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(i+1).trim())[0]!==_o)throw"Expected '>' after between selector: "+e;if(t=t.map(Io),(n=Io(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t;return n}(e):function(e){var t,n,r={source:vo},i=[],o=[0,0],a=0,u=0,c=e.length,s=0;if(e[c-1]===wo){if(!((s=e.lastIndexOf(Eo))>=0))throw"Unmatched right brace: "+e;try{o=function(e){var t=e.split(No);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!=n)throw e;return n})}(e.substring(s+1,c-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),c=e.length,s=0}if(!c)throw e;e[0]===Oo&&(a=++s);(t=Ao(e,s,ko))<c&&(i.push(e.substring(u,t).trim()),u=s=++t);if((s=Ao(e,s,xo))===c)i.push(e.substring(u,c).trim());else if(i.push(e.substring(u,s).trim()),n=[],(u=++s)===c)throw"Unmatched left bracket: "+e;for(;s<c;){if((s=Ao(e,s,So))===c)throw"Unmatched left bracket: "+e;if(n.push(e.substring(u,s).trim()),s<c-1&&e[++s]!==xo)throw"Expected left bracket: "+e;u=++s}if(!(c=i.length)||To.test(i[c-1]))throw"Invalid event selector: "+e;c>1?(r.type=i[1],a?r.markname=i[0].slice(1):(l=i[0],yo.hasOwnProperty(l)?r.marktype=i[0]:r.source=i[0])):r.type=i[0];var l;"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);o[0]&&(r.throttle=o[0]);o[1]&&(r.debounce=o[1]);return r}(e)}function zo(e){return!!e.signal}function Ro(e){return!!e.step}function Lo(e){return!i(e)&&("field"in e&&"data"in e)}var Fo=ue({opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeMiterLimit:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,cursor:1,href:1,tooltip:1,cornerRadius:1});function jo(e,t,n,r){void 0===r&&(r={header:!1});var o=e.combine(),a=o.orient,u=o.scale,c=o.title,s=o.zindex,l=S(o,["orient","scale","title","zindex"]);if(oe(l).forEach(function(e){var n=Ae[e];n&&n!==t&&"both"!==n&&delete l[e]}),"grid"===t){if(!l.grid)return;if(l.encode){var f=l.encode.grid;l.encode=x({},f?{grid:f}:{}),0===oe(l.encode).length&&delete l.encode}return x({scale:u,orient:a},l,{domain:!1,labels:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:void 0!==s?s:0})}if(r.header||!e.mainExtracted){if(l.encode){for(var d=0,p=Ce;d<p.length;d++){var h=p[d];e.hasAxisPart(h)||delete l.encode[h]}0===oe(l.encode).length&&delete l.encode}var m=function(e,t){return i(e)?e.map(function(e){return mr(e,t)}).join(", "):e}(c,n);return x({scale:u,orient:a,grid:!1},m?{title:m}:{},l,{zindex:void 0!==s?s:1})}}var Uo={titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontWeight:"fontWeight",titleLimit:"limit"},Po={labelAngle:"angle",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelLimit:"limit"},Mo=Object.keys(Uo),Ho=Object.keys(Po),qo=Object.freeze({HEADER_TITLE_PROPERTIES_MAP:Uo,HEADER_LABEL_PROPERTIES_MAP:Po,HEADER_TITLE_PROPERTIES:Mo,HEADER_LABEL_PROPERTIES:Ho});function Wo(e){return!(!e||"count"!==e.op&&!e.field||!e.op)}function Go(e){return!!e&&i(e)}var Bo=Object.freeze({isSortField:Wo,isSortArray:Go});function Yo(e,t){var n=t[e+"Offset"];if(n)return n}function Vo(e,t,n,r){return Xo(e,t,{binSuffix:"start"===n?void 0:"end"},r?{offset:r}:{})}function Xo(e,t,n,r){var i=x({},t?{scale:t}:{},{field:or(e,n)});return r?x({},i,r):i}function Qo(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function Ko(e,t,n,r,i,o){if(t){if(tr(t)){if(t.bin)return Q([Ue,Pe],e)&&t.type===qn?i&&i.impute?Xo(t,n,{binSuffix:"mid"}):function(e,t){return{signal:'(scale("'+t+'", '+or(e,{expr:"datum"})+') + scale("'+t+'", '+or(e,{binSuffix:"end",expr:"datum"})+"))/2"}}(t,n):Xo(t,n,Oa(t,e)?{binSuffix:"range"}:{});if(r){var a=r.get("type");if(di(a))return"band"===a?Xo(t,n,{binSuffix:"range"},{band:.5}):Xo(t,n,{binSuffix:"range"})}return Xo(t,n,{})}if(rr(t)){var u=t.value;return Q(["x","x2"],e)&&"width"===u?{field:{group:"width"}}:Q(["y","y2"],e)&&"height"===u?{field:{group:"height"}}:{value:u}}}return"function"==typeof o?o():o}function Jo(e,t){if(e){if(tr(e))return ma(e,e.format,"datum",t);if(rr(e))return{value:e.value}}}function Zo(e){return x({},e,{mult:.5})}function $o(e,t,n,r,o){return function(){if(a(e)){if(n){var u=r.get("type");if(Q([Br.LOG,Br.TIME,Br.UTC],u))"bar"!==o&&"area"!==o||fn(Zt.nonZeroScaleUsedWithLengthMark(o,t,{scaleType:u}));else{if(function(e){if(!1!==e.get("zero"))return!0;var t=e.domains;return!!i(t)&&J(t,function(e){return i(e)&&2===e.length&&e[0]<=0&&e[1]>=0})}(r))return{scale:n,value:0};"bar"!==o&&"area"!==o||fn(Zt.nonZeroScaleUsedWithLengthMark(o,t,{zeroFalse:!1===r.explicit.zero}))}}return"zeroOrMin"===e?"x"===t?{value:0}:{field:{group:"height"}}:"x"===t?{field:{group:"width"}}:{value:0}}return e}}function ea(e,t){var n,r;void 0===t&&(t={valueOnly:!1});var i=e.markDef,o=e.encoding,a=e.config,u=i.filled,c=i.type,s={fill:ha("fill",i,a),stroke:ha("stroke",i,a),color:ha("color",i,a)},l=Q(["bar","point","circle","square","geoshape"],c)?"transparent":void 0,f={fill:i.fill||s.fill||l,stroke:i.stroke||s.stroke},d=u?"fill":"stroke",p=x({},f.fill?{fill:{value:f.fill}}:{},f.stroke?{stroke:{value:f.stroke}}:{});return o.fill||o.stroke?(i.color&&fn(Zt.droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o})),x({},ia("fill",e,{defaultValue:f.fill||l}),ia("stroke",e,{defaultValue:f.stroke}))):o.color?x({},p,ia("color",e,{vgChannel:d,defaultValue:i[d]||i.color||s[d]||s.color||(u?l:void 0)})):i.fill||i.stroke?(i.color&&fn(Zt.droppingColor("property",{fill:"fill"in i,stroke:"stroke"in i})),p):i.color?x({},p,((n={})[d]={value:i.color},n)):s.fill||s.stroke?p:s.color?x({},l?{fill:{value:"transparent"}}:{},((r={})[d]={value:s.color},r)):{}}function ta(e,t){return x({},function(e,t){return Fo.reduce(function(n,r){return void 0!==e[r]&&"ignore"!==t[r]&&(n[r]={value:e[r]}),n},{})}(e.markDef,t),ea(e),ia("opacity",e),function(e){var t=e.encoding.tooltip;if(i(t)){var n=t.map(function(t){var n=void 0!==t.title?t.title:or(t,{binSuffix:"range"}),r=Jo(t,e.config).signal;return'"'+n+'": '+r});return{tooltip:{signal:"{"+n.join(", ")+"}"}}}return ua(e,"tooltip",t)}(e),aa(e,"href"))}function na(e){return e+" !== null && !isNaN("+e+")"}function ra(e){if("filter"===e.config.invalidValues){var t=["x","y"].map(function(t){var n=e.getScaleComponent(t);if(n&&hi(n.get("type")))return e.vgField(t,{expr:"datum"})}).filter(function(e){return!!e}).map(na);if(t.length>0)return{defined:{signal:t.join(" && ")}}}return{}}function ia(e,t,n){void 0===n&&(n={});var r=n.defaultValue,i=n.vgChannel,o=n.defaultRef||(void 0!==r?{value:r}:void 0),a=t.encoding[e];return oa(t,a,i||e,function(n){return Ko(e,n,t.scaleName(e),t.getScaleComponent(e),null,o)})}function oa(e,t,n,r){var o,a,u=t&&t.condition,c=r(t);if(u){var s=(i(u)?u:[u]).map(function(t){var n=r(t),i=Qn(t)?mc(e,t.selection):Dc(e,t.test);return x({test:i},n)});return(o={})[n]=s.concat(void 0!==c?[c]:[]),o}return void 0!==c?((a={})[n]=c,a):{}}function aa(e,t){return void 0===t&&(t="text"),ua(e,t,e.encoding[t])}function ua(e,t,n){return oa(e,n,t,function(t){return Jo(t,e.config)})}function ca(e,t,n){var r,i,o,a=n.scaleName(t),u="x"===t?"width":"height";if(n.encoding.size||void 0!==n.markDef.size)if(n.markDef.orient){var c=((r={})[t+"c"]=Xo(e,a,{},{band:.5}),r);if(vr(n.encoding.size))return x({},c,ia("size",n,{vgChannel:u}));if(rr(n.encoding.size))return x({},c,ia("size",n,{vgChannel:u}));if(void 0!==n.markDef.size)return x({},c,((i={})[u]={value:n.markDef.size},i))}else fn(Zt.cannotApplySizeToNonOrientedMark(n.markDef.type));return(o={})[t]=Xo(e,a,{binSuffix:"range"}),o[u]=Qo(a),o}function sa(e,t,n,r){var i="x"===e?"width":"height";return x({},fa(e,t,n,"x"===e?"xc":"yc"),ia("size",t,{defaultRef:r,vgChannel:i}))}function la(e,t,n,r,i){return"x"===t?{x2:Vo(e,n,"start",i?0:r),x:Vo(e,n,"end",i?r:0)}:{y2:Vo(e,n,"start",i?r:0),y:Vo(e,n,"end",i?0:r)}}function fa(e,t,n,r){var i,o=t.encoding,a=t.mark,u=t.stack,c=o[e],s=t.scaleName(e),l=t.getScaleComponent(e),f=Yo(e,t.markDef),d=c||!o.latitude&&!o.longitude?x({},function(e,t,n,r,i,o){return tr(t)&&i&&e===i.fieldChannel?Xo(t,n,{suffix:"end"}):Ko(e,t,n,r,i,o)}(e,o[e],s,l,u,$o(n,e,s,l,a)),f?{offset:f}:{}):{field:t.getName(e)};return(i={})[r||e]=d,i}function da(e,t,n){var r,i=e.encoding,o=e.mark,a=e.stack,u="x2"===n?"x":"y",c=i[u],s=e.scaleName(u),l=e.getScaleComponent(u),f=Yo(n,e.markDef),d=c||!i.latitude&&!i.longitude?x({},function(e,t,n,r,i,o,a){return tr(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?Xo(t,r,{suffix:"start"}):Ko(e,n,r,i,o,a)}(n,c,i[n],s,l,a,$o(t,u,s,l,o)),f?{offset:f}:{}):{field:e.getName(n)};return(r={})[n]=d,r}function pa(e){return[].concat(e.type,e.style||[])}function ha(e,t,n){var r=n.mark[e],i=n[t.type];void 0!==i[e]&&(r=i[e]);for(var o=0,a=pa(t);o<a.length;o++){var u=a[o],c=n.style[u],s=e;c&&void 0!==c[s]&&(r=c[s])}return r}function ma(e,t,n,r){var i=va(e,t,r);if(e.bin)return{signal:xa(or(e,{expr:n}),or(e,{expr:n,binSuffix:"end"}),i,r)};if("quantitative"===e.type)return{signal:""+ya(or(e,{expr:n,binSuffix:"range"}),i)};if(kr(e)){var o=ir(e)&&e.scale&&e.scale.type===Br.UTC;return{signal:Sa(or(e,{expr:n}),e.timeUnit,t,r.text.shortTimeLabels,r.timeFormat,o,!0)}}return{signal:"''+"+or(e,{expr:n})}}function ga(e,t){return void 0!==e?e:t}function va(e,t,n){if(e.type===qn)return t||n.numberFormat}function ya(e,t){return"format("+e+', "'+(t||"")+'")'}function ba(e,t,n){return ya(e,t||n.numberFormat)}function xa(e,t,n,r){return e+" === null || isNaN("+e+') ? "null" : '+ba(e,n,r)+' + " - " + '+ba(t,n,r)}function Sa(e,t,n,r,i,o,a){return void 0===a&&(a=!1),!t||n?(n=n||i)||a?(o?"utc":"time")+"Format("+e+", '"+n+"')":void 0:jn(t,e,r,o)}function Ea(e,t){return(i(e)?e:[e]).reduce(function(e,n){return e.field.push(or(n,t)),e.order.push(n.sort||"ascending"),e},{field:[],order:[]})}function wa(e,t){var n=e.slice();return t.forEach(function(e){for(var t=0,r=n;t<r.length;t++){var i=r[t];if(V(i)===V(e))return}n.push(e)}),n}function ka(e,t){return e===t?e:e+", "+t}function Na(e,t){if(i(e.value)&&i(t.value))return{explicit:e.explicit,value:wa(e.value,t.value)};if(!i(e.value)&&!i(t.value))return{explicit:e.explicit,value:ka(e.value,t.value)};throw new Error("It should never reach here")}function Oa(e,t){return e.bin?wt(t)&&Q(["ordinal","nominal"],e.type):(console.warn("Only use this method with binned field defs"),!1)}function _a(e,t){return oe(e).reduce(function(n,r){var i=e[r];return x({},n,oa(t,i,r,function(e){return{value:e.value}}))},{})}var Ta=function(){function e(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}return e.prototype.clone=function(){throw new Error("Cannot clone node")},e.prototype.producedFields=function(){return{}},e.prototype.dependentFields=function(){return{}},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,e.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype.numChildren=function(){return this._children.length},e.prototype.addChild=function(e){this._children.push(e)},e.prototype.removeChild=function(e){this._children.splice(this._children.indexOf(e),1)},e.prototype.remove=function(){for(var e=0,t=this._children;e<t.length;e++){t[e].parent=this._parent}this._parent.removeChild(this)},e.prototype.insertAsParentOf=function(e){var t=e.parent;t.removeChild(this),this.parent=t,e.parent=this},e.prototype.swapWithParent=function(){for(var e=this._parent,t=e.parent,n=0,r=this._children;n<r.length;n++){r[n].parent=e}this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this},e}(),Ca=function(e){function t(t,n,r,i){var o=e.call(this,t,n)||this;return o.type=r,o.refCounts=i,o._source=o._name=n,!o.refCounts||o._name in o.refCounts||(o.refCounts[o._name]=0),o}return b(t,e),t.prototype.clone=function(){var e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e},t.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},t.prototype.isRequired=function(){return!!this.refCounts[this._name]},t.prototype.setSource=function(e){this._source=e},t}(Ta),Aa=function(e){function t(t,n){var r=e.call(this,t)||this;return r.transform=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this.transform))},t.parseAllForSortIndex=function(e,n){return n.forEachFieldDef(function(n,r){if(ir(n)&&Go(n.sort)){var i=n.field,o=n.timeUnit,a=n.sort,u=a.map(function(e,t){return zc({field:i,timeUnit:o,equal:e})+" ? "+t+" : "}).join("")+a.length;e=new t(e,{calculate:u,as:Da(n,r)})}}),e},t.prototype.producedFields=function(){var e={};return e[this.transform.as]=!0,e},t.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},t}(Ta);function Da(e,t,n){return or(e,{prefix:t,suffix:"sort_index",expr:n})}var Ia=["row","column"],za=["header","footer"];function Ra(e,t){var n=e.component.layoutHeaders[t].title,r="row"===t?"left":void 0,i=e.config?e.config:void 0,o=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0;return{name:t+"-title",type:"group",role:t+"-title",title:x({text:n,offset:10,orient:r,style:"guide-title"},ja(i,o,Mo,Uo))}}function La(e,t){for(var n=e.component.layoutHeaders[t],r=[],i=0,o=za;i<o.length;i++){var a=o[i];if(n[a])for(var u=0,c=n[a];u<c.length;u++){var s=c[u];r.push(Fa(e,t,a,n,s))}}return r}function Fa(e,t,n,r,o){var a,u;if(o){var c=null,s=r.facetFieldDef;if(s&&o.labels){var l=s.header,f=void 0===l?{}:l,d=f.format,p=f.labelAngle,h=e.config?e.config:void 0,m=x({},(90+(u=((u=p)%360+360)%360))%180==0?{}:u<90||270<u?{align:{value:"right"}}:135<=u&&u<225?{align:{value:"left"}}:{});c=x({text:ma(s,d,"parent",e.config),offset:10,orient:"row"===t?"left":"top",style:"guide-label"},ja(h,s,Ho,Po),oe(m).length>0?{encode:{update:m}}:{})}var g=o.axes,v=g&&g.length>0;if(c||v){var y="row"===t?"height":"width";return x({name:e.getName(t+"_"+n),type:"group",role:t+"-"+n},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:function(e,t){var n=e.sort;return Wo(n)?{field:or(n,{expr:"datum"}),order:n.order||"ascending"}:i(n)?{field:Da(e,t,"datum"),order:"ascending"}:{field:or(e,{expr:"datum"}),order:n||"ascending"}}(s,t)}:{},c?{title:c}:{},o.sizeSignal?{encode:{update:(a={},a[y]=o.sizeSignal,a)}}:{},v?{axes:g}:{})}}return null}function ja(e,t,n,r){for(var i={},o=0,a=n;o<a.length;o++){var u=a[o];e&&e.header&&e.header[u]&&(i[r[u]]=e.header[u]),t&&t.header&&t.header[u]&&(i[r[u]]=t.header[u])}return i}function Ua(e){return[].concat(Pa(e,"width"),Pa(e,"height"))}function Pa(e,t){var n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];var i=e.getSizeSignalRef(t).signal;if("range-step"===r){var o=e.getScaleComponent(n);if(o){var a=o.get("type"),u=o.get("range");if(di(a)&&Ro(u)){var c=e.scaleName(n);if(Hu(e.parent))if("independent"===e.parent.component.resolve.scale[n])return[Ma(c,u)];return[Ma(c,u),{name:i,update:Ha(c,o,"domain('"+c+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:i,value:r}]}function Ma(e,t){return{name:e+"_step",value:t.step}}function Ha(e,t,n){var r=t.get("type"),i=t.get("padding"),o=t.get("paddingOuter");o=void 0!==o?o:i;var a=t.get("paddingInner");return"bandspace("+n+", "+(a="band"===r?void 0!==a?a:i:1)+", "+o+") * "+e+"_step"}function qa(e,t){var n=e.scale[t],r=Q(yt,t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&fn(Zt.independentScaleMeansIndependentGuide(t)),"independent"):e[r][t]||"shared"}var Wa=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.explicit=e,this.implicit=t}return e.prototype.clone=function(){return new e(ce(this.explicit),ce(this.implicit))},e.prototype.combine=function(){return x({},this.explicit,this.implicit)},e.prototype.get=function(e){return void 0!==this.explicit[e]?this.explicit[e]:this.implicit[e]},e.prototype.getWithExplicit=function(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}},e.prototype.setWithExplicit=function(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)},e.prototype.set=function(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this},e.prototype.copyKeyFromSplit=function(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)},e.prototype.copyKeyFromObject=function(e,t){void 0!==t[e]&&this.set(e,t[e],!0)},e.prototype.copyAll=function(e){for(var t=0,n=oe(e.combine());t<n.length;t++){var r=n[t],i=e.getWithExplicit(r);this.setWithExplicit(r,i)}},e}();function Ga(e){return{explicit:!0,value:e}}function Ba(e){return{explicit:!1,value:e}}function Ya(e){return function(t,n,r,i){var o=e(t.value,n.value);return o>0?t:o<0?n:Va(t,n,r,i)}}function Va(e,t,n,r){return e.explicit&&t.explicit&&fn(Zt.mergeConflictingProperty(n,r,e.value,t.value)),e}function Xa(e,t,n,r,i){return void 0===i&&(i=Va),void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:V(e.value)===V(t.value)?e:i(e,t,n,r)}var Qa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return b(t,e),t}(Wa);function Ka(e){return Za(e,function(e,t){return Math.max(e,t.value)})}function Ja(e){return Za(e,function(e,t){return void 0!==e?e:t.value})}function Za(e,t){return er(e)?(i(e.condition)?e.condition:[e.condition]).reduce(t,e.value):rr(e)?e.value:void 0}var $a=Object.freeze({symbols:function(e,t,n,r,o){if("gradient"!==o){var a=x({},function(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=ha(o,t.markDef,t.config);void 0!==a&&(e[o]={value:a})}return e}({},n,tn),ea(n));switch(n.mark){case Rt:case Ut:case jt:a.shape={value:"square"};break;case Wt:case Gt:a.shape={value:n.mark}}var u=n.markDef,c=n.encoding,s=u.filled;if(a.fill)if("fill"===r||s&&r===Ke)delete a.fill;else if(a.fill.field)delete a.fill;else if(i(a.fill)){var l=Ja(c.fill||c.color)||u.fill||s&&u.color;l&&(a.fill={value:l})}if(a.stroke)if("stroke"===r||!s&&r===Ke)delete a.stroke;else if(a.stroke.field)delete a.stroke;else if(i(a.stroke)){var f=Ja(c.stroke||c.color)||u.stroke||!s&&u.color;f&&(a.stroke={value:f})}if(a.fill&&"transparent"!==a.fill.value&&!a.stroke&&(a.stroke={value:"transparent"}),r!==Xe){var d=Ja(c.shape)||u.shape;d&&(a.shape={value:d})}if(r!==rt){var p=Ka(c.opacity)||u.opacity;p&&(a.opacity={value:p})}return a=x({},a,t),oe(a).length>0?a:void 0}},gradient:function(e,t,n,r,i){var o={};if("gradient"===i){var a=Ka(n.encoding.opacity)||n.markDef.opacity;a&&(o.opacity={value:a})}return o=x({},o,t),oe(o).length>0?o:void 0},labels:function(e,t,n,r,i){var o=n.legend(r),a=n.config,u={};if(kr(e)){var c=n.getScaleComponent(r).get("type")===Br.UTC,s=Sa("datum.value",e.timeUnit,o.format,a.legend.shortTimeLabels,a.timeFormat,c);t=x({},s?{text:{signal:s}}:{},t)}return u=x({},u,t),oe(u).length>0?u:void 0}});function eu(e){Mu(e)?e.component.legends=function(e){var t=e.encoding;return[Ke,Je,Ze,Qe,Xe,rt].reduce(function(n,r){var i=t[r];return!e.legend(r)||!e.getScaleComponent(r)||tr(i)&&r===Xe&&i.type===Yn||(n[r]=function(e,t){var n=e.fieldDef(t),r=e.legend(t),i=new Qa({},function(e,t){var n;switch(t){case Ke:var r=e.scaleName(Ke);return e.markDef.filled?{fill:r}:{stroke:r};case Je:case Ze:case Qe:case Xe:case rt:return(n={})[t]=e.scaleName(t),n}}(e,t));Jr.forEach(function(n){var o=function(e,t,n,r){var i=r.fieldDef(n);switch(e){case"format":return va(i,t.format,r.config);case"title":var o=void 0!==i.title?i.title:t.title||(void 0===t.title?void 0:null);return ga(o,mr(i,r.config))||void 0;case"values":return function(e,t){var n=e.values;if(n)return Or(t,n)}(t,i);case"type":return ga(t.type,function(e,t,n){if(st(t)&&("quantitative"===e&&!pi(n)||"temporal"===e&&Q(["time","utc"],n)))return"gradient"}(i.type,n,r.getScaleComponent(n).get("type")))}return t[e]}(n,r,t,e);if(void 0!==o){var a="values"===n?!!r.values:"title"===n&&o===e.fieldDef(t).title||o===r[n];(a||void 0===e.config.legend[n])&&i.set(n,o,a)}});var o=r.encoding||{},a=["labels","legend","title","symbols","gradient"].reduce(function(r,a){var u=_a(o[a]||{},e),c=$a[a]?$a[a](n,u,e,t,i.get("type")):u;return void 0!==c&&oe(c).length>0&&(r[a]={update:c}),r},{});oe(a).length>0&&i.set("encode",a,!!r.encoding);return i}(e,r)),n},{})}(e):e.component.legends=function(e){for(var t=e.component,n=t.legends,r=t.resolve,i=function(t){eu(t),oe(t.component.legends).forEach(function(i){r.legend[i]=qa(e.component.resolve,i),"shared"===r.legend[i]&&(n[i]=tu(n[i],t.component.legends[i]),n[i]||(r.legend[i]="independent",delete n[i]))})},o=0,a=e.children;o<a.length;o++){var u=a[o];i(u)}return oe(n).forEach(function(t){for(var n=0,i=e.children;n<i.length;n++){var o=i[n];o.component.legends[t]&&"shared"===r.legend[t]&&delete o.component.legends[t]}}),n}(e)}function tu(e,t){if(!e)return t.clone();var n=e.getWithExplicit("orient"),r=t.getWithExplicit("orient");if(!n.explicit||!r.explicit||n.value===r.value){for(var i=!1,o=function(n){var r=Xa(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",function(e,t){switch(n){case"title":return Na(e,t);case"type":return i=!0,Ba("symbol")}return Va(e,t,n,"legend")});e.setWithExplicit(n,r)},a=0,u=Zr;a<u.length;a++){o(u[a])}return i&&(((e.implicit||{}).encode||{}).gradient&&de(e.implicit,["encode","gradient"]),((e.explicit||{}).encode||{}).gradient&&de(e.explicit,["encode","gradient"])),e}}function nu(e){for(var t=e.component.legends,n={},r=0,i=oe(t);r<i.length;r++){var o=i[r],a=e.getScaleComponent(o),u=V(a.domains);if(n[u])for(var c=0,s=n[u];c<s.length;c++){tu(s[c],t[o])||n[u].push(t[o])}else n[u]=[t[o].clone()]}return $(ae(n)).map(function(e){return e.combine()})}function ru(e){return Gu(e)||Wu(e)||qu(e)?function(e){return e.children.reduce(function(e,t){return e.concat(t.assembleProjections())},iu(e))}(e):iu(e)}function iu(e){var t=e.component.projection;if(!t||t.merged)return[];var n=t.combine(),r=n.name,i=S(n,["name"]),o={signal:"["+t.size.map(function(e){return e.signal}).join(", ")+"]"},a=t.data.reduce(function(t,n){var r=zo(n)?n.signal:"data('"+e.lookupDataSource(n)+"')";return Q(t,r)||t.push(r),t},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[x({name:r,size:o,fit:{signal:a.length>1?"["+a.join(", ")+"]":a[0]}},i)]}var ou=["type","clipAngle","clipExtent","center","rotate","precision","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"],au=function(e){function t(t,n,r,i){var o=e.call(this,x({},n),{name:t})||this;return o.specifiedProjection=n,o.size=r,o.data=i,o.merged=!1,o}return b(t,e),t}(Wa);function uu(e){Mu(e)?e.component.projection=function(e){var t=e.specifiedProjection,n=e.config;if(e.hasProjection){var r=[];return[[Ge,qe],[Be,We]].forEach(function(t){(e.channelHasField(t[0])||e.channelHasField(t[1]))&&r.push({signal:e.getName("geojson_"+r.length)})}),e.channelHasField(Xe)&&e.fieldDef(Xe).type===Yn&&r.push({signal:e.getName("geojson_"+r.length)}),0===r.length&&r.push(e.requestDataName(po)),new au(e.projectionName(!0),x({},n.projection||{},t||{}),[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")],r)}return}(e):e.component.projection=function(e){if(0===e.children.length)return;var t,n=Z(e.children,function(e){uu(e);var n=e.component.projection;if(n){if(t){var r=function(e,t){var n=Z(ou,function(n){return!e.explicit.hasOwnProperty(n)&&!t.explicit.hasOwnProperty(n)||!(!e.explicit.hasOwnProperty(n)||!t.explicit.hasOwnProperty(n)||V(e.get(n))!==V(t.get(n)))});if(V(e.size)===V(t.size)){if(n)return e;if(V(e.explicit)===V({}))return t;if(V(t.explicit)===V({}))return e}return null}(t,n);return r&&(t=r),!!r}return t=n,!0}return!0});if(t&&n){var r=e.projectionName(!0),i=new au(r,t.specifiedProjection,t.size,ce(t.data));return e.children.forEach(function(e){e.component.projection&&(i.data=i.data.concat(e.component.projection.data),e.renameProjection(e.component.projection.get("name"),r),e.component.projection.merged=!0)}),i}return}(e)}var cu=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dimensions=n,i.measures=r,i}return b(t,e),t.prototype.clone=function(){return new t(null,x({},this.dimensions),ce(this.measures))},t.makeFromEncoding=function(e,n){var r=!1;n.forEachFieldDef(function(e){e.aggregate&&(r=!0)});var i={},o={};return r?(n.forEachFieldDef(function(e,t){var r=e.aggregate,a=e.field;r?"count"===r?(i["*"]=i["*"]||{},i["*"].count=or(e)):(i[a]=i[a]||{},i[a][r]=or(e),wt(t)&&"unaggregated"===n.scaleDomain(t)&&(i[a].min=or({field:a,aggregate:"min"}),i[a].max=or({field:a,aggregate:"max"}))):function(e,t,n){n.bin?(e[or(n,{})]=!0,e[or(n,{binSuffix:"end"})]=!0,Oa(n,t)&&(e[or(n,{binSuffix:"range"})]=!0)):e[or(n)]=!0}(o,t,e)}),oe(o).length+oe(i).length===0?null:new t(e,o,i)):null},t.makeFromTransform=function(e,n){for(var r={},i={},o=0,a=n.aggregate;o<a.length;o++){var u=(d=a[o]).op,c=d.field,s=d.as;u&&("count"===u?(i["*"]=i["*"]||{},i["*"].count=s||or(d)):(i[c]=i[c]||{},i[c][u]=s||or(d)))}for(var l=0,f=n.groupby||[];l<f.length;l++){var d;r[d=f[l]]=!0}return oe(r).length+oe(i).length===0?null:new t(e,r,i)},t.prototype.merge=function(e){re(this.dimensions,e.dimensions)?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ln.debug.apply(ln,arguments)}("different dimensions, cannot merge"):(!function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var i in r)r.hasOwnProperty(i)&&(n in e?e[n][i]=r[i]:e[n]={op:r[i]})}}(this.measures,e.measures),e.remove())},t.prototype.addDimensions=function(e){var t=this;e.forEach(function(e){return t.dimensions[e]=!0})},t.prototype.dependentFields=function(){var e={};return oe(this.dimensions).forEach(function(t){return e[t]=!0}),oe(this.measures).forEach(function(t){return e[t]=!0}),e},t.prototype.producedFields=function(){var e=this,t={};return oe(this.measures).forEach(function(n){oe(e.measures[n]).forEach(function(e){t[e+"_"+n]=!0})}),t},t.prototype.assemble=function(){for(var e=[],t=[],n=[],r=0,i=oe(this.measures);r<i.length;r++)for(var o=i[r],a=0,u=oe(this.measures[o]);a<u.length;a++){var c=u[a];n.push(this.measures[o][c]),e.push(c),t.push(o)}return{type:"aggregate",groupby:oe(this.dimensions),ops:e,fields:t,as:n}},t}(Ta),su=function(e){function t(t,n,r,o){var a=e.call(this,t)||this;a.model=n,a.name=r,a.data=o;for(var u=0,c=[Ve,Ye];u<c.length;u++){var s=c[u],l=n.facet[s];if(l){var f=l.bin,d=l.sort;a[s]=x({name:n.getName(s+"_domain"),fields:[or(l)].concat(f?[or(l,{binSuffix:"end"})]:[])},Wo(d)?{sortField:d}:i(d)?{sortIndexField:Da(l,s)}:{})}}return a.childModel=n.child,a}return b(t,e),Object.defineProperty(t.prototype,"fields",{get:function(){return(this.column&&this.column.fields||[]).concat(this.row&&this.row.fields||[])},enumerable:!0,configurable:!0}),t.prototype.getSource=function(){return this.name},t.prototype.getChildIndependentFieldsWithStep=function(){for(var e={},t=0,n=["x","y"];t<n.length;t++){var r=n[t],i=this.childModel.component.scales[r];if(i&&!i.merged){var o=i.get("type"),a=i.get("range");if(di(o)&&Ro(a)){var u=Ou(_u(this.childModel,r));u?e[r]=u:fn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return e},t.prototype.assembleRowColumnData=function(e,t,n){var r="row"===e?"y":"x",i=[],o=[],a=[];n[r]&&(t?(i.push("distinct_"+n[r]),o.push("max")):(i.push(n[r]),o.push("distinct")),a.push("distinct_"+n[r]));var u=this[e],c=u.sortField,s=u.sortIndexField;if(c){var l=c.op,f=c.field;i.push(f),o.push(l),a.push(or(c))}else s&&(i.push(s),o.push("max"),a.push(s));return{name:this[e].name,source:t||this.data,transform:[x({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:o,as:a}:{})]}},t.prototype.assemble=function(){var e=[],t=null,n=this.getChildIndependentFieldsWithStep();if(this.column&&this.row&&(n.x||n.y)){t="cross_"+this.column.name+"_"+this.row.name;var r=[].concat(n.x?[n.x]:[],n.y?[n.y]:[]),i=r.map(function(){return"distinct"});e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.column.fields.concat(this.row.fields),fields:r,ops:i}]})}for(var o=0,a=[Ve,Ye];o<a.length;o++){var u=a[o];this[u]&&e.push(this.assembleRowColumnData(u,t,n))}return e},t}(Ta),lu=function(e){function t(t,n){var r=e.call(this,t)||this;return r.fieldDefs=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,x({},this.fieldDefs))},t.make=function(e,n){var r=n.config,i=n.mark;if("filter"!==r.invalidValues)return null;var o=n.reduceFieldDef(function(e,t,r){var o=wt(r)&&n.getScaleComponent(r);o&&(!hi(o.get("type"))||t.aggregate||Yt(i)||(e[t.field]=t));return e},{});return oe(o).length?new t(e,o):null},Object.defineProperty(t.prototype,"filter",{get:function(){return this.fieldDefs},enumerable:!0,configurable:!0}),t.prototype.assemble=function(){var e=this,t=oe(this.filter).reduce(function(t,n){var r=e.fieldDefs[n],i=or(r,{expr:"datum"});return null!==r&&(t.push(i+" !== null"),t.push("!isNaN("+i+")")),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null},t}(Ta);var fu=function(e){function t(t,n){var r=e.call(this,t)||this;return r._parse=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this._parse))},t.makeExplicit=function(e,t,n){var r={},i=t.data;return i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)},t.makeImplicitFromFilterTransform=function(e,t,n){var r={};return function e(t,n){if(G(t))e(t.not,n);else if(W(t))for(var r=0,i=t.and;r<i.length;r++)e(i[r],n);else if(q(t))for(var o=0,a=t.or;o<a.length;o++)e(a[o],n);else n(t)}(t.filter,function(e){if(Ac(e)){var t=null;wc(e)?t=e.equal:Tc(e)?t=e.range[0]:Cc(e)&&(t=(e.oneOf||e.in)[0]),t&&(pn(t)?r[e.field]="date":g(t)?r[e.field]="number":a(t)&&(r[e.field]="string")),e.timeUnit&&(r[e.field]="date")}}),0===oe(r).length?null:this.makeWithAncestors(e,{},r,n)},t.makeImplicitFromEncoding=function(e,t,n){var r={};return(Mu(t)||Hu(t))&&t.forEachFieldDef(function(e){kr(e)?r[e.field]="date":wr(e)?ke(e.aggregate)||(r[e.field]="number"):ye(e.field)>1?e.field in r||(r[e.field]="flatten"):ir(e)&&Wo(e.sort)&&ye(e.sort.field)>1&&(e.sort.field in r||(r[e.sort.field]="flatten"))}),this.makeWithAncestors(e,{},r,n)},t.makeWithAncestors=function(e,n,r,i){for(var o=0,a=oe(r);o<a.length;o++){var u=a[o];void 0!==(l=i.getWithExplicit(u)).value&&(l.explicit||l.value===r[u]||"derived"===l.value||"flatten"===r[u]?delete r[u]:fn(Zt.differentParse(u,r[u],l.value)))}for(var c=0,s=oe(n);c<s.length;c++){var l;u=s[c];void 0!==(l=i.get(u))&&(l===n[u]?delete n[u]:fn(Zt.differentParse(u,n[u],l)))}var f=new Wa(n,r);i.copyAll(f);for(var d={},p=0,h=oe(f.combine());p<h.length;p++){var m=h[p],g=f.get(m);null!==g&&(d[m]=g)}return 0===oe(d).length||i.parseNothing?null:new t(e,d)},Object.defineProperty(t.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){this._parse=x({},this._parse,e.parse),e.remove()},t.prototype.assembleFormatParse=function(){for(var e={},t=0,n=oe(this._parse);t<n.length;t++){var r=n[t],i=this._parse[r];1===ye(r)&&(e[r]=i)}return e},t.prototype.producedFields=function(){return v(oe(this._parse))},t.prototype.dependentFields=function(){return v(oe(this._parse))},t.prototype.assembleTransforms=function(e){var t=this;return void 0===e&&(e=!1),oe(this._parse).filter(function(t){return!e||ye(t)>1}).map(function(e){var n=function(e,t){var n=he(e);return"number"===t?"toNumber("+n+")":"boolean"===t?"toBoolean("+n+")":"string"===t?"toString("+n+")":"date"===t?"toDate("+n+")":"flatten"===t?n:0===t.indexOf("date:")?"timeParse("+n+","+t.slice(5,t.length)+")":0===t.indexOf("utc:")?"utcParse("+n+","+t.slice(4,t.length)+")":(fn(Zt.unrecognizedParse(t)),null)}(e,t._parse[e]);return n?{type:"formula",expr:n,as:ve(e)}:null}).filter(function(e){return null!==e})},t}(Ta),du=function(e){function t(t){var n=e.call(this,null)||this;if(lo(t=t||{name:"source"}))n._data={values:t.values};else if(so(t)){if(n._data={url:t.url},t.format||(t.format={}),!t.format||!t.format.type){var r=/(?:\.([^.]+))?$/.exec(t.url)[1];Q(["json","csv","tsv","dsv","topojson"],r)||(r="json"),t.format.type=r}}else fo(t)&&(n._data={});if(t.name&&(n._name=t.name),t.format){var i=t.format,o=(i.parse,S(i,["parse"]));n._data.format=o}return n}return b(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.hasName=function(){return!!this._name},Object.defineProperty(t.prototype,"dataName",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),t.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},t.prototype.hash=function(){return lo(this._data)?(this._hash||(this._hash=X(this._data)),this._hash):so(this._data)?X([this._data.url,this._data.format]):this._name},t.prototype.assemble=function(){return x({name:this._name},this._data,{transform:[]})},t}(Ta),pu=function(e){function t(t,n){var r=e.call(this,t)||this;return r.formula=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this.formula))},t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef(function(e,t){if(t.timeUnit){var n=or(t);e[n]={as:n,timeUnit:t.timeUnit,field:t.field}}return e},{});return 0===oe(r).length?null:new t(e,r)},t.makeFromTransform=function(e,n){var r;return new t(e,((r={})[n.field]={as:n.as,timeUnit:n.timeUnit,field:n.field},r))},t.prototype.merge=function(e){this.formula=x({},this.formula,e.formula),e.remove()},t.prototype.producedFields=function(){var e={};return ae(this.formula).forEach(function(t){e[t.as]=!0}),e},t.prototype.dependentFields=function(){var e={};return ae(this.formula).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return ae(this.formula).map(function(e){return{type:"formula",as:e.as,expr:Fn(e.timeUnit,e.field)}})},t}(Ta);function hu(e){return function t(n){if(!(n instanceof du)){var r=n.parent;e(n)&&t(r)}}}function mu(e){var t=e.parent;if(e instanceof fu){if(t instanceof du)return!1;if(t.numChildren()>1)return!0;if(t instanceof fu)t.merge(e);else{if(ie(t.producedFields(),e.dependentFields()))return!0;e.swapWithParent()}}return!0}function gu(e){return!(e instanceof Ca||e.numChildren()>0||e instanceof su)&&(e.remove(),!0)}function vu(e){var t={};return hu(function(e){if(e instanceof pu){var n=e.producedFields();oe(n).every(function(e){return!!t[e]})?e.remove():t=x({},t,n)}return!0})(e)}var yu=function(e){function t(t,n){var r=e.call(this,t)||this;return r._stack=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this._stack))},t.makeFromTransform=function(e,n){var r=n.stack,o=n.groupby,u=n.as,c=n.offset,s=void 0===c?"zero":c,l=[],f=[];if(void 0!==n.sort)for(var d=0,p=n.sort;d<p.length;d++){var h=p[d];l.push(h.field),f.push(void 0===h.order?"ascending":h.order)}return new t(e,{stackField:r,groupby:o,offset:s,sort:{field:l,order:f},facetby:[],as:function(e){return i(e)&&e.every(function(e){return a(e)})&&e.length>1}(u)?u:a(u)?[u,u+"_end"]:[n.stack+"_start",n.stack+"_end"]})},t.makeFromEncoding=function(e,n){var r,o=n.stack;if(!o)return null;o.groupbyChannel&&(r=n.fieldDef(o.groupbyChannel));var a,u=function(e){return e.stack.stackBy.reduce(function(e,t){var n=or(t.fieldDef);return n&&e.push(n),e},[])}(n),c=n.encoding.order;a=i(c)||tr(c)?Ea(c):u.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]});var s=n.vgField(o.fieldChannel);return new t(e,{dimensionFieldDef:r,stackField:s,facetby:[],stackby:u,sort:a,offset:o.offset,impute:o.impute,as:[s+"_start",s+"_end"]})},Object.defineProperty(t.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),t.prototype.addDimensions=function(e){this._stack.facetby=this._stack.facetby.concat(e)},t.prototype.dependentFields=function(){var e={};e[this._stack.stackField]=!0,this.getGroupbyFields().forEach(function(t){return e[t]=!0}),this._stack.facetby.forEach(function(t){return e[t]=!0});var t=this._stack.sort.field;return i(t)?t.forEach(function(t){return e[t]=!0}):e[t]=!0,e},t.prototype.producedFields=function(){return this._stack.as.reduce(function(e,t){return e[t]=!0,e},{})},t.prototype.getGroupbyFields=function(){var e=this._stack,t=e.dimensionFieldDef,n=e.impute,r=e.groupby;return t?t.bin?n?[or(t,{binSuffix:"mid"})]:[or(t,{}),or(t,{binSuffix:"end"})]:[or(t)]:r||[]},t.prototype.assemble=function(){var e=[],t=this._stack,n=t.facetby,r=t.dimensionFieldDef,i=t.stackField,o=t.stackby,a=t.sort,u=t.offset,c=t.impute,s=t.as;if(c&&r){var l=r?or(r,{binSuffix:"mid"}):void 0;r.bin&&e.push({type:"formula",expr:"("+or(r,{expr:"datum"})+"+"+or(r,{expr:"datum",binSuffix:"end"})+")/2",as:l}),e.push({type:"impute",field:i,groupby:o,key:l,method:"value",value:0})}return e.push({type:"stack",groupby:this.getGroupbyFields().concat(n),field:i,sort:a,as:s,offset:u}),e},t}(Ta),bu="scale_";function xu(e){if(e instanceof su)if(1!==e.numChildren()||e.children[0]instanceof Ca){!function e(t){if(t instanceof Ca&&t.type===po&&1===t.numChildren()){var n=t.children[0];n instanceof su||(n.swapWithParent(),e(t))}}(e.model.component.data.main),$(e.children.map((n=e,function e(t){if(!(t instanceof su)){var r=t.clone();if(r instanceof Ca){var i=bu+r.getSource();r.setSource(i),n.model.component.data.outputNodes[i]=r}else(r instanceof cu||r instanceof yu)&&r.addDimensions(n.fields);return $(t.children.map(e)).forEach(function(e){return e.parent=r}),[r]}return $(t.children.map(e))}))).forEach(function(t){return t.parent=e.model.component.data.main})}else{var t=e.children[0];(t instanceof cu||t instanceof yu)&&t.addDimensions(e.fields),t.swapWithParent(),xu(e)}else e.children.forEach(xu);var n}function Su(e){e instanceof lu&&Z(ae(e.filter),function(e){return null===e})&&e.remove(),e instanceof Ca&&!e.isRequired()&&e.remove(),e.children.forEach(Su)}function Eu(e){var t=[];return e.forEach(function e(n){0===n.numChildren()?t.push(n):n.children.forEach(e)}),t}function wu(e){Mu(e)?function(e){var t=e.specifiedScales,n=e.component.scales;oe(n).forEach(function(r){var i=t[r],o=i?i.domain:void 0,a=function(e,t){var n=e.getScaleComponent(t).get("type"),r=function(e,t,n,r){if("unaggregated"===e){var i=Nu(t,n),o=i.valid,a=i.reason;if(!o)return void fn(a)}else if(void 0===e&&r.useUnaggregatedDomain){var o=Nu(t,n).valid;if(o)return"unaggregated"}return e}(e.scaleDomain(t),e.fieldDef(t),n,e.config.scale);r!==e.scaleDomain(t)&&(e.specifiedScales[t]=x({},e.specifiedScales[t],{domain:r}));if("x"===t&&e.channelHasField("x2"))return e.channelHasField("x")?ku(n,r,e,"x").concat(ku(n,r,e,"x2")):ku(n,r,e,"x2");if("y"===t&&e.channelHasField("y2"))return e.channelHasField("y")?ku(n,r,e,"y").concat(ku(n,r,e,"y2")):ku(n,r,e,"y2");return ku(n,r,e,t)}(e,r),u=n[r];if(u.domains=a,yi(o)&&u.set("domainRaw",{signal:pc+X(o)},!0),e.component.data.isFaceted){for(var c=e;!Hu(c)&&c.parent;)c=c.parent;var s=c.component.resolve.scale[r];if("shared"===s)for(var l=0,f=a;l<f.length;l++){var d=f[l];Lo(d)&&(d.data=bu+d.data.replace(bu,""))}}})}(e):function(e){for(var t=0,n=e.children;t<n.length;t++){var r=n[t];wu(r)}var i=e.component.scales;oe(i).forEach(function(t){for(var n,r=null,o=0,a=e.children;o<a.length;o++){var u=a[o],c=u.component.scales[t];if(c){n=void 0===n?c.domains:n.concat(c.domains);var s=c.get("domainRaw");r&&s&&r.signal!==s.signal&&fn("The same selection must be used to override scale domains in a layered view."),r=s}}i[t].domains=n,r&&i[t].set("domainRaw",r,!0)})}(e)}function ku(e,t,n,r){var i=n.fieldDef(r);if(t&&"unaggregated"!==t&&!yi(t)){var o=i.type,a=i.timeUnit;return"temporal"===o||a?function(e,t,n){return e.map(function(e){return{signal:"{data: "+Nr(e,{timeUnit:n,type:t})+"}"}})}(t,o,a):[t]}var u=n.stack;if(u&&r===u.fieldChannel)return"normalize"===u.offset?[[0,1]]:[{data:s=n.requestDataName(po),field:n.vgField(r,{suffix:"start"})},{data:s,field:n.vgField(r,{suffix:"end"})}];var c=wt(r)?function(e,t,n){if(!di(n))return;var r=e.fieldDef(t),i=r.sort;if(Go(i))return{op:"min",field:Da(r,t),order:"ascending"};if(Wo(i))return x({},i,i.field?{field:ge(i.field)}:{});if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(Q(["ascending",void 0],i))return!0;return}(n,r,e):void 0;if("unaggregated"===t){var s=n.requestDataName(po),l=i.field;return[{data:s,field:or({field:l,aggregate:"min"})},{data:s,field:or({field:l,aggregate:"max"})}]}if(!i.bin)return c?[{data:se(c)?n.requestDataName(po):n.requestDataName(ho),field:n.vgField(r),sort:c}]:[{data:n.requestDataName(po),field:n.vgField(r)}];if(pi(e)){var f=n.getName(Tt(i.bin)+"_"+i.field+"_bins");return[{signal:"sequence("+f+".start, "+f+".stop + "+f+".step, "+f+".step)"}]}return di(e)?[{data:se(c)?n.requestDataName(po):n.requestDataName(ho),field:n.vgField(r,Oa(i,r)?{binSuffix:"range"}:{}),sort:!0!==c&&Wo(c)?c:{field:n.vgField(r,{}),op:"min"}}]:"x"!==r&&"y"!==r?[{data:n.requestDataName(po),field:n.vgField(r,{})}]:Ct(i.bin)&&i.bin.extent?[i.bin.extent]:[{data:s=n.requestDataName(po),field:n.vgField(r,{})},{data:s,field:n.vgField(r,{binSuffix:"end"})}]}function Nu(e,t){return e.aggregate?_e[e.aggregate]?"quantitative"===e.type&&"log"===t?{valid:!1,reason:Zt.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:Zt.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:{valid:!1,reason:Zt.unaggregateDomainHasNoEffectForRawField(e)}}function Ou(e){if(Lo(e)&&a(e.field))return e.field;if(function(e){return!i(e)&&"fields"in e&&!("data"in e)}(e)){for(var t=void 0,n=0,r=e.fields;n<r.length;n++){var o=r[n];if(Lo(o)&&a(o.field))if(t){if(t!==o.field)return fn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),t}else t=o.field}return fn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),t}return function(e){return!i(e)&&"fields"in e&&"data"in e}(e)?(fn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),a(t=e.fields[0])?t:void 0):void 0}function _u(e,t){return function(e){var t=ne(e.map(function(e){return Lo(e)?(e.sort,S(e,["sort"])):e}),X),n=ne(e.map(function(e){if(Lo(e)){var t=e.sort;return void 0===t||se(t)||("count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}}).filter(function(e){return void 0!==e}),X);if(1===t.length){if(Lo(a=e[0])&&n.length>0){var r=n[0];return n.length>1&&(fn(Zt.MORE_THAN_ONE_SORT),r=!0),x({},a,{sort:r})}return a}var i=ne(n.map(function(e){return!0===e?e:"count"===e.op?e:(fn(Zt.domainSortDropped(e)),!0)}),X),o=void 0;1===i.length?o=i[0]:i.length>1&&(fn(Zt.MORE_THAN_ONE_SORT),o=!0);var a,u=ne(e.map(function(e){return Lo(e)?e.data:null}),function(e){return e});return 1===u.length&&null!==u[0]?a=x({data:u[0],fields:t.map(function(e){return e.field})},o?{sort:o}:{}):x({fields:t},o?{sort:o}:{})}(e.component.scales[t].domains.map(function(t){return Lo(t)&&(t.data=e.lookupDataSource(t.data)),t}))}function Tu(e){return oe(e.component.scales).reduce(function(t,n){var r=e.component.scales[n];if(r.merged)return t;var o=r.combine(),a=o.domainRaw,c=o.range,s=o.name,l=o.type,f=(o.domainRaw,o.range,S(o,["name","type","domainRaw","range"]));return c=function(e,t,n,r){if("x"===r||"y"===r){if(Ro(e))return{step:{signal:t+"_step"}};if(i(e)&&2===e.length){var o=e[0],a=e[1];if(0===o&&zo(a))return[0,{signal:n.getSizeName(a.signal)}];if(zo(o)&&0===a)return[{signal:n.getSizeName(o.signal)},0]}}return e}(c,s,e,n),a&&function(e){return e.signal.indexOf(pc)>=0}(a)&&(a=function(e,t){var n=JSON.parse(t.signal.replace(pc,"")),r=le(n.selection),i=e.component.selection&&e.component.selection[r];if(!i)return i=e.getSelectionComponent(r,n.selection),n.encoding||n.field||(n.field=i.project[0].field,i.project.length>1&&fn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+u(n.field)+".")),{signal:vc(i.type).scaleDomain+"("+u(r+lc)+", "+u(n.encoding||null)+", "+u(n.field||null)+("global"===i.resolve?")":", "+u(i.resolve)+")")};fn('Use "bind": "scales" to setup a binding for scales and selections within the same view.');return{signal:"null"}}(e,a)),t.push(x({name:s,type:l,domain:_u(e,n)},a?{domainRaw:a}:{},{range:c},f)),t},[])}var Cu=function(e){function t(t,n){var r=e.call(this,{},{name:t})||this;return r.merged=!1,r.domains=[],r.setWithExplicit("type",n),r}return b(t,e),t}(Wa),Au=["range","rangeStep","scheme"];function Du(e){Mu(e)?function(e){var t=e.component.scales;Et.forEach(function(n){var r=t[n];if(r){var i=e.getScaleComponent(n),o=e.specifiedScales[n],a=e.fieldDef(n),u="x"===n?"width":"y"===n?"height":void 0,c=u?!!e.component.layoutSize.get(u):void 0,s=i.get("type"),l=Q(["point","band"],s)||!!o.rangeStep;u&&e.fit&&!c&&l&&(fn(Zt.CANNOT_FIX_RANGE_STEP_WITH_FIT),c=!0);var f=function(e){var t=[],n=e.getScaleComponent("x"),r=n&&n.get("range");r&&Ro(r)&&g(r.step)&&t.push(r.step);var i=e.getScaleComponent("y"),o=i&&i.get("range");o&&Ro(o)&&g(o.step)&&t.push(o.step);return t}(e),d=function(e,t,n,r,i,o,a,u,c,s){for(var l=u||null===r.rangeStep,f=0,d=Au;f<d.length;f++){var p=d[f];if(void 0!==r[p]){var h=wi(t,p),m=ki(e,p);if(h)if(m)fn(m);else switch(p){case"range":return Ga(r[p]);case"scheme":return Ga(Iu(r[p]));case"rangeStep":var g=r[p];if(null!==g){if(!u)return Ga({step:g});fn(Zt.rangeStepDropped(e))}}else fn(Zt.scalePropertyNotWorkWithScaleType(t,p,e))}}return Ba(function(e,t,n,r,i,o,a,u,c){switch(e){case Ue:case Pe:if(Q(["point","band"],t)&&!c)if(e===Ue&&"text"===o){if(r.scale.textXRangeStep)return{step:r.scale.textXRangeStep}}else if(r.scale.rangeStep)return{step:r.scale.rangeStep};return e===Pe&&hi(t)?[{signal:a},0]:[0,{signal:a}];case Qe:var s=function(e,t,n){if(t)return 0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Zt.incompatibleChannel("size",e))}(o,i,r),l=function(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:zu(t,n.scale)-1;case"line":case"trail":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var i=zu(t,r);return(i-2)*(i-2)}throw new Error(Zt.incompatibleChannel("size",e))}(o,u,r);return[s,l];case Xe:return"symbol";case Ke:case Je:case Ze:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===o||"geoshape"===o?"heatmap":"ramp";case rt:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+e)}(e,t,n,i,o,a,c,s,l))}(n,s,a.type,o,e.config,r.get("zero"),e.mark,c,e.getName(u),f);r.setWithExplicit("range",d)}})}(e):Lu(e,"range")}function Iu(e){if(vi(e)){var t={scheme:e.name};return e.count&&(t.count=e.count),e.extent&&(t.extent=e.extent),t}return{scheme:e}}function zu(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}function Ru(e,t){Mu(e)?function(e,t){var n=e.component.scales;oe(n).forEach(function(r){var i=e.specifiedScales[r],o=n[r],a=e.getScaleComponent(r),u=e.fieldDef(r),c=e.config,s=i[t],l=a.get("type"),f=wi(l,t),d=ki(r,t);if(void 0!==s&&(f?d&&fn(d):fn(Zt.scalePropertyNotWorkWithScaleType(l,t,r))),f&&void 0===d)if(void 0!==s)o.copyKeyFromObject(t,i);else{var p=function(e,t,n,r,i,o,a,u,c){var s=c.scale;switch(e){case"nice":return function(e,t,n){if(n.bin||Q([Br.TIME,Br.UTC],e))return;return Q([Ue,Pe],t)}(r,t,n);case"padding":return function(e,t,n,r,i,o){if(Q([Ue,Pe],e)){if(mi(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;var a=i.type,u=i.orient;if("bar"===a&&!r.bin&&("vertical"===u&&"x"===e||"horizontal"===u&&"y"===e))return o.continuousBandSize}if(t===Br.POINT)return n.pointPadding}return}(t,r,s,n,u,c.bar);case"paddingInner":return function(e,t,n){if(void 0!==e)return;if(Q([Ue,Pe],t))return n.bandPaddingInner;return}(i,t,s);case"paddingOuter":return function(e,t,n,r,i){if(void 0!==e)return;if(Q([Ue,Pe],t)&&n===Br.BAND)return void 0!==i.bandPaddingOuter?i.bandPaddingOuter:r/2;return}(i,t,r,o,s);case"reverse":return function(e,t){if(hi(e)&&"descending"===t)return!0;return}(r,n.sort);case"zero":return function(e,t,n,r){if(n&&"unaggregated"!==n)return!1;if("size"===e&&"quantitative"===t.type)return!0;if(!t.bin&&Q([Ue,Pe],e)){var i=r.orient,o=r.type;return!Q(["bar","area","line","trail"],o)||!("horizontal"===i&&"y"===e||"vertical"===i&&"x"===e)}return!1}(t,n,a,u)}return s[e]}(t,r,u,a.get("type"),a.get("padding"),a.get("paddingInner"),i.domain,e.markDef,c);void 0!==p&&o.set(t,p,!1)}})}(e,t):Lu(e,t)}function Lu(e,t){for(var n=e.component.scales,r=0,i=e.children;r<i.length;r++){var o=i[r];"range"===t?Du(o):Ru(o,t)}oe(n).forEach(function(r){for(var i,o=0,a=e.children;o<a.length;o++){var u=a[o].component.scales[r];if(u)i=Xa(i,u.getWithExplicit(t),t,"scale",Ya(function(e,n){switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))}n[r].setWithExplicit(t,i)})}function Fu(e,t,n,r,i){var o=function(e,t,n,r){switch(t.type){case"nominal":case"ordinal":if(st(e)||"discrete"===Ot(e))return"shape"===e&&"ordinal"===t.type&&fn(Zt.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(Q(["x","y"],e)){if(Q(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return st(e)?"sequential":"discrete"===Ot(e)?(fn(Zt.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return st(e)?t.bin?"bin-ordinal":"sequential":"discrete"===Ot(e)?(fn(Zt.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"latitude":case"longitude":case"geojson":return}throw new Error(Zt.invalidFieldType(t.type))}(t,n,r);return wt(t)?void 0!==e?Oi(t,e)?Ni(e,n.type,n.bin)?e:(fn(Zt.scaleTypeNotWorkWithFieldDef(e,o)),o):(fn(Zt.scaleTypeNotWorkWithChannel(t,e,o)),o):o:null}function ju(e){Mu(e)?e.component.scales=function(e){var t=e.encoding,n=e.config,r=e.mark;return Et.reduce(function(i,o){var a,u=void 0,c=t[o];if(tr(c)&&r===qt&&o===Xe&&c.type===Yn)return i;if(tr(c)?(a=c,u=c.scale):$n(c)?(a=c.condition,u=c.condition.scale):o===Ue?a=vr(t.x2):o===Pe&&(a=vr(t.y2)),a&&null!==u&&!1!==u){var s=(u=u||{}).type,l=Fu(u.type,o,a,r,n.scale);i[o]=new Cu(e.scaleName(o+"",!0),{value:l,explicit:s===l})}return i},{})}(e):e.component.scales=function(e){for(var t=e.component.scales={},n={},r=e.component.resolve,i=function(t){ju(t),oe(t.component.scales).forEach(function(i){if(r.scale[i]=r.scale[i]||function(e,t){if(Gu(t)||Hu(t))return"shared";if(Wu(t)||qu(t))return Q(yt,e)?"independent":"shared";throw new Error("invalid model type for resolve")}(i,e),"shared"===r.scale[i]){var o=n[i],a=t.component.scales[i].getWithExplicit("type");o?ni(o.value,a.value)?n[i]=Xa(o,a,"type","scale",Uu):(r.scale[i]="independent",delete n[i]):n[i]=a}})},o=0,a=e.children;o<a.length;o++){var u=a[o];i(u)}return oe(n).forEach(function(r){var i=e.scaleName(r,!0),o=n[r];t[r]=new Cu(i,o);for(var a=0,u=e.children;a<u.length;a++){var c=u[a],s=c.component.scales[r];s&&(c.renameScale(s.get("name"),i),s.merged=!0)}}),t}(e)}var Uu=Ya(function(e,t){return ii(e)-ii(t)});var Pu=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e},e}();function Mu(e){return e&&"unit"===e.type}function Hu(e){return e&&"facet"===e.type}function qu(e){return e&&"repeat"===e.type}function Wu(e){return e&&"concat"===e.type}function Gu(e){return e&&"layer"===e.type}var Bu=function(){function e(e,t,n,r,i,o){var u,c,s,l,f,d,p,h,m=this;this.children=[],this.correctDataNames=function(e){return e.from&&e.from.data&&(e.from.data=m.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=m.lookupDataSource(e.from.facet.data)),e},this.parent=t,this.config=r,this.repeater=i,this.name=e.name||n,this.title=a(e.title)?{text:e.title}:e.title,this.scaleNameMap=t?t.scaleNameMap:new Pu,this.projectionNameMap=t?t.projectionNameMap:new Pu,this.layoutSizeNameMap=t?t.layoutSizeNameMap:new Pu,this.data=e.data,this.description=e.description,this.transforms=Wc(e.transform||[]),this.layout=Vi(e)||Xi(e)?void 0:(c=(u=e||{}).align,s=void 0===c?void 0:c,l=u.center,f=void 0===l?void 0:l,d=u.bounds,p=void 0===d?void 0:d,h=u.spacing,{align:s,bounds:p,center:f,spacing:void 0===h?void 0:h}),this.component={data:{sources:t?t.component.data.sources:{},outputNodes:t?t.component.data.outputNodes:{},outputNodeRefCounts:t?t.component.data.outputNodeRefCounts:{},isFaceted:Yi(e)||t&&t.component.data.isFaceted&&!e.data},layoutSize:new Wa,layoutHeaders:{row:{},column:{}},mark:null,resolve:x({scale:{},axis:{},legend:{}},o||{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),e.prototype.initSize=function(e){var t=e.width,n=e.height;t&&this.component.layoutSize.set("width",t,!0),n&&this.component.layoutSize.set("height",n,!0)},e.prototype.parse=function(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseProjection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},e.prototype.parseScale=function(){!function(e){ju(e),wu(e);for(var t=0,n=Si;t<n.length;t++)Ru(e,n[t]);Du(e)}(this)},e.prototype.parseProjection=function(){uu(this)},e.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},e.prototype.parseLegend=function(){eu(this)},e.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},e.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},e.prototype.assembleLayout=function(){if(this.layout){var e=this.layout,t=e.align,n=e.bounds,r=e.center,i=e.spacing,o=void 0===i?{}:i;return x({padding:g(o)?o:{row:o.row||10,column:o.column||10}},this.assembleDefaultLayout(),t?{align:t}:{},n?{bounds:n}:{},r?{center:r}:{})}},e.prototype.assembleDefaultLayout=function(){return{}},e.prototype.assembleHeaderMarks=function(){for(var e=this.component.layoutHeaders,t=[],n=0,r=Ia;n<r.length;n++){e[a=r[n]].title&&t.push(Ra(this,a))}for(var i=0,o=Ia;i<o.length;i++){var a=o[i];t=t.concat(La(this,a))}return t},e.prototype.assembleAxes=function(){return e=this.component.axes,t=this.config,n=e.x,r=void 0===n?[]:n,i=e.y,o=void 0===i?[]:i,r.map(function(e){return jo(e,"main",t)}).concat(r.map(function(e){return jo(e,"grid",t)}),o.map(function(e){return jo(e,"main",t)}),o.map(function(e){return jo(e,"grid",t)})).filter(function(e){return e});var e,t,n,r,i,o},e.prototype.assembleLegends=function(){return nu(this)},e.prototype.assembleProjections=function(){return ru(this)},e.prototype.assembleTitle=function(){var e=x({},Ai(this.config.title).nonMark,this.title);if(e.text)return Q(["unit","layer"],this.type)||(e.anchor&&"start"!==e.anchor&&fn(Zt.cannotSetTitleAnchor(this.type)),e.anchor="start"),oe(e).length>0?e:void 0},e.prototype.assembleGroup=function(e){void 0===e&&(e=[]);var t={};(e=e.concat(this.assembleSelectionSignals())).length>0&&(t.signals=e);var n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var r=!this.parent||Hu(this.parent)?function e(t){return Gu(t)||Wu(t)||qu(t)?t.children.reduce(function(t,n){return t.concat(e(n))},Tu(t)):Tu(t)}(this):[];r.length>0&&(t.scales=r);var i=this.assembleAxes();i.length>0&&(t.axes=i);var o=this.assembleLegends();return o.length>0&&(t.legends=o),t},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(Mu(r)){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e){return le((this.name?this.name+"_":"")+e)},e.prototype.requestDataName=function(e){var t=this.getName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t},e.prototype.getSizeSignalRef=function(e){if(Hu(this.parent)){var t="width"===e?"x":"y",n=this.component.scales[t];if(n&&!n.merged){var r=n.get("type"),i=n.get("range");if(di(r)&&Ro(i)){var o=n.get("name"),a=Ou(_u(this,t));return a?{signal:Ha(o,n,or({aggregate:"distinct",field:a},{expr:"datum"}))}:(fn("Unknown field for ${channel}.  Cannot calculate view size."),null)}}}return{signal:this.layoutSizeNameMap.get(this.getName(e))}},e.prototype.lookupDataSource=function(e){var t=this.component.data.outputNodes[e];return t?t.getSource():e},e.prototype.getSizeName=function(e){return this.layoutSizeNameMap.get(e)},e.prototype.renameLayoutSize=function(e,t){this.layoutSizeNameMap.rename(e,t)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.renameProjection=function(e,t){this.projectionNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){return t?this.getName(e):pt(e)&&wt(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0},e.prototype.projectionName=function(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0},e.prototype.getScaleComponent=function(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0},e.prototype.getSelectionComponent=function(e,t){var n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(Zt.selectionNotFound(t));return n},e}(),Yu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return b(t,e),t.prototype.vgField=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);if(n)return or(n,t)},t.prototype.reduceFieldDef=function(e,t,n){return Rr(this.getMapping(),function(t,n,r){var i=vr(n);return i?e(t,i,r):t},t,n)},t.prototype.forEachFieldDef=function(e,t){zr(this.getMapping(),function(t,n){var r=vr(t);r&&e(r,n)},t)},t}(Bu),Vu={has:function(e){return"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var r=n.scales=[];n.project.forEach(function(t){var i=t.channel,o=e.getScaleComponent(i),a=o?o.get("type"):void 0;o&&hi(a)&&!pi(a)?(o.set("domainRaw",{signal:Sc(n,i,"data")},!0),r.push(i),e.repeater&&e.repeater.row===e.repeater.column&&e.getScaleComponent(i===Ue?Pe:Ue).set("domainRaw",{signal:Sc(n,i,"data")},!0)):fn(Zt.SCALE_BINDINGS_CONTINUOUS)})},topLevelSignals:function(e,t,n){if(!e.parent)return n;var r=t.scales.filter(function(e){return!n.filter(function(n){return n.name===Sc(t,e,"data")}).length});return n.concat(r.map(function(e){return{name:Sc(t,e,"data")}}))},signals:function(e,t,n){return e.parent&&t.scales.forEach(function(e){var r=n.filter(function(n){return n.name===Sc(t,e,"data")})[0];r.push="outer",delete r.value,delete r.update}),n}};function Xu(e,t){return"domain("+u(e.scaleName(t))+")"}var Qu="_scale_trigger",Ku={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(e,t){var n=t.name,r=Vu.has(t),i=[],o=[],a=[],c=[];if(t.translate&&!r){var s="!event.item || event.item.mark.name !== "+u(n+"_brush");Ju(t,function(e,t){var n=t.between[0].filter||(t.between[0].filter=[]);n.indexOf(s)<0&&n.push(s)})}return t.project.forEach(function(n){var r=n.channel;if(r===Ue||r===Pe){var s=function(e,t,n){var r=Sc(t,n,"visual"),i=Sc(t,n,"data"),o=Vu.has(t),a=u(e.scaleName(n)),c=e.getScaleComponent(n),s=c?c.get("type"):void 0,l=e.getSizeSignalRef(n===Ue?"width":"height").signal,f=n+"(unit)",d=Ju(t,function(e,t){return e.concat({events:t.between[0],update:"["+f+", "+f+"]"},{events:t,update:"["+r+"[0], clamp("+f+", 0, "+l+")]"})});return d.push({events:{signal:t.name+Qu},update:hi(s)&&!pi(s)?"[scale("+a+", "+i+"[0]), scale("+a+", "+i+"[1])]":"[0, 0]"}),o?[{name:i,on:[]}]:[{name:r,value:[],on:d},{name:i,on:[{events:{signal:r},update:r+"[0] === "+r+"[1] ? null : invert("+a+", "+r+")"}]}]}(e,t,r),l=Sc(t,r,"data"),f=Sc(t,r,"visual"),d=u(e.scaleName(r)),p=hi(e.getScaleComponent(r).get("type"))?"+":"";i.push.apply(i,s),a.push(l),o.push("{encoding: "+u(r)+", field: "+u(n.field)+", extent: "+l+"}"),c.push({scaleName:e.scaleName(r),expr:"(!isArray("+l+") || ("+p+"invert("+d+", "+f+")[0] === "+p+l+"[0] && "+p+"invert("+d+", "+f+")[1] === "+p+l+"[1]))"})}else fn("Interval selections only support x and y encoding channels.")}),r||i.push({name:n+Qu,update:c.map(function(e){return e.expr}).join(" && ")+" ? "+(n+Qu)+" : {}"}),i.concat({name:n+fc,on:[{events:a.map(function(e){return{signal:e}}),update:a.join(" && ")+" ? {unit: "+bc(e)+", intervals: ["+o.join(", ")+"]} : null"}]})},modifyExpr:function(e,t){return t.name+fc+", "+("global"===t.resolve?"true":"{unit: "+bc(e)+"}")},marks:function(e,t,n){var r=t.name,i=Ec(t),o=i.xi,a=i.yi,c="data("+u(t.name+lc)+")";if(Vu.has(t))return n;var s={x:null!==o?{signal:r+"_x[0]"}:{value:0},y:null!==a?{signal:r+"_y[0]"}:{value:0},x2:null!==o?{signal:r+"_x[1]"}:{field:{group:"width"}},y2:null!==a?{signal:r+"_y[1]"}:{field:{group:"height"}}};if("global"===t.resolve)for(var l=0,f=oe(s);l<f.length;l++){var d=f[l];s[d]=[x({test:c+".length && "+c+"[0].unit === "+bc(e)},s[d]),{value:0}]}var p=t.mark,h=p.fill,m=p.fillOpacity,g=S(p,["fill","fillOpacity"]),v=oe(g).reduce(function(e,t){return e[t]=[{test:[null!==o&&r+"_x[0] !== "+r+"_x[1]",null!=a&&r+"_y[0] !== "+r+"_y[1]"].filter(function(e){return e}).join(" && "),value:g[t]},{value:null}],e},{});return[{name:r+"_brush_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:h},fillOpacity:{value:m}},update:s}}].concat(n,{name:r+"_brush",type:"rect",clip:!0,encode:{enter:{fill:{value:"transparent"}},update:x({},s,v)}})}};function Ju(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(fn(n+" is not an ordered event stream for interval selections"),e)},[])}var Zu={has:function(e){return"interval"!==e.type&&e.nearest},marks:function(e,t,n){var r=Ec(t),i=r.x,o=r.y,a=e.mark;if(Yt(a))return fn(Zt.nearestNotSupportForContinuous(a)),n;var u={name:e.getName("voronoi"),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:{expr:i||!i&&!o?"datum.datum.x || 0":"0"},y:{expr:o||!i&&!o?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]},c=0,s=!1;return n.forEach(function(t,n){var r=t.name||"";r===e.component.mark[0].name?c=n:r.indexOf("voronoi")>=0&&(s=!0)}),s||n.splice(c+1,0,u),n}};function $u(e,t){var n=t.project,r=Zu.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum",i=[],o=n.map(function(e){return u(e.channel)}).filter(function(e){return e}).join(", "),a=n.map(function(e){return u(e.field)}).join(", "),c=n.map(function(t){var n=t.channel,o=e.fieldDef(n);return o&&o.bin?(i.push(t.field),"["+he(e.vgField(n,{}),r)+", "+he(e.vgField(n,{binSuffix:"end"}),r)+"]"):""+he(t.field,r)}).join(", ");return[{name:t.name+fc,value:{},on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+bc(e)+", encodings: ["+o+"], fields: ["+a+"], values: ["+c+"]"+(i.length?", "+i.map(function(e){return u("bin_"+e)+": 1"}).join(", "):"")+"} : null",force:!0}]}]}var ec={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:$u,modifyExpr:function(e,t){return t.name+fc+", "+("global"===t.resolve?"null":"{unit: "+bc(e)+"}")}},tc={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:$u,topLevelSignals:function(e,t,n){var r=n.filter(function(e){return e.name===t.name}),i="data("+u(t.name+lc)+")",o=i+"[0].values";return r.length?n:n.concat({name:t.name,update:i+".length && {"+t.project.map(function(e,t){return e.field+": "+o+"["+t+"]"}).join(", ")+"}"})},modifyExpr:function(e,t){return t.name+fc+", "+("global"===t.resolve?"true":"{unit: "+bc(e)+"}")}},nc="_translate_anchor",rc="_translate_delta";function ic(e,t,n,r,i){var o=t.name,a=Vu.has(t),u=i.filter(function(e){return e.name===Sc(t,n,a?"data":"visual")})[0],c=o+nc,s=o+rc,l=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(n),d=f.get("type"),p=c+".extent_"+n,h=(a?"log"===d?"panLog":"pow"===d?"panPow":"panLinear":"panLinear")+"("+p+", "+(""+(a&&n===Ue?"-":"")+s+"."+n+" / "+(a?""+l:"span("+p+")"))+(a&&"pow"===d?", "+(f.get("exponent")||1):"")+")";u.on.push({events:{signal:s},update:a?h:"clampRange("+h+", 0, "+l+")"})}var oc="_zoom_anchor",ac="_zoom_delta";function uc(e,t,n,r,i){var o=t.name,a=Vu.has(t),u=i.filter(function(e){return e.name===Sc(t,n,a?"data":"visual")})[0],c=e.getSizeSignalRef(r).signal,s=e.getScaleComponent(n),l=s.get("type"),f=a?Xu(e,n):u.name,d=o+ac,p=(a?"log"===l?"zoomLog":"pow"===l?"zoomPow":"zoomLinear":"zoomLinear")+"("+f+", "+(""+o+oc+"."+n)+", "+d+(a&&"pow"===l?", "+(s.get("exponent")||1):"")+")";u.on.push({events:{signal:d},update:a?p:"clampRange("+p+", 0, "+c+")"})}var cc={project:{has:function(e){var t=e;return void 0!==t.fields||void 0!==t.encodings},parse:function(e,t,n){var r={},i={};(t.fields||[]).forEach(function(e){return r[e]=null}),(t.encodings||[]).forEach(function(t){var n=e.fieldDef(t);if(n)if(n.timeUnit){var o=e.vgField(t);r[o]=t,i[o]={as:o,field:n.field,timeUnit:n.timeUnit}}else r[n.field]=t;else fn(Zt.cannotProjectOnChannelWithoutField(t))});var o=n.project||(n.project=[]);for(var a in r)r.hasOwnProperty(a)&&o.push({field:a,channel:r[a]});var u=n.fields||(n.fields={});o.filter(function(e){return e.channel}).forEach(function(e){return u[e.channel]=e.field}),oe(i).length&&(n.timeUnit=new pu(null,i))}},toggle:{has:function(e){return"multi"===e.type&&e.toggle},signals:function(e,t,n){return n.concat({name:t.name+"_toggle",value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var r=t.name+fc,i=t.name+"_toggle";return i+" ? null : "+r+", "+("global"===t.resolve?i+" ? null : true, ":i+" ? null : {unit: "+bc(e)+"}, ")+i+" ? "+r+" : null"}},scales:Vu,translate:{has:function(e){return"interval"===e.type&&e.translate},signals:function(e,t,n){var r=t.name,i=Vu.has(t),o=r+nc,a=Ec(t),u=a.x,c=a.y,s=go(t.translate,"scope");return i||(s=s.map(function(e){return e.between[0].markname=r+"_brush",e})),n.push({name:o,value:{},on:[{events:s.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit)"+(null!==u?", extent_x: "+(i?Xu(e,Ue):"slice("+Sc(t,"x","visual")+")"):"")+(null!==c?", extent_y: "+(i?Xu(e,Pe):"slice("+Sc(t,"y","visual")+")"):"")+"}"}]},{name:r+rc,value:{},on:[{events:s,update:"{x: "+o+".x - x(unit), y: "+o+".y - y(unit)}"}]}),null!==u&&ic(e,t,Ue,"width",n),null!==c&&ic(e,t,Pe,"height",n),n}},zoom:{has:function(e){return"interval"===e.type&&e.zoom},signals:function(e,t,n){var r=t.name,i=Vu.has(t),o=r+ac,a=Ec(t),c=a.x,s=a.y,l=u(e.scaleName(Ue)),f=u(e.scaleName(Pe)),d=go(t.zoom,"scope");return i||(d=d.map(function(e){return e.markname=r+"_brush",e})),n.push({name:r+oc,on:[{events:d,update:i?"{"+[l?"x: invert("+l+", x(unit))":"",f?"y: invert("+f+", y(unit))":""].filter(function(e){return!!e}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:d,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==c&&uc(e,t,"x","width",n),null!==s&&uc(e,t,"y","height",n),n}},inputs:{has:function(e){return"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var r=t.name,i=t.project,o=t.bind,a=Zu.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.forEach(function(e){var i=le(r+"_"+e.field);n.filter(function(e){return e.name===i}).length||n.unshift({name:i,value:"",on:[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? "+he(e.field,a)+" : null"}],bind:o[e.field]||o[e.channel]||o})}),n},signals:function(e,t,n){var r=t.name,i=t.project,o=n.filter(function(e){return e.name===r+fc})[0],a=i.map(function(e){return u(e.field)}).join(", "),c=i.map(function(e){return le(r+"_"+e.field)});return c.length&&(o.update=c.join(" && ")+" ? {fields: ["+a+"], values: ["+c.join(", ")+"]} : null"),delete o.value,delete o.on,n}},nearest:Zu};function sc(e,t){for(var n in cc)cc[n].has(e)&&t(cc[n])}var lc="_store",fc="_tuple",dc="_modify",pc="_selection_domain_";function hc(e,t){return gc(e,function(n,r){t=r.marks?r.marks(e,n,t):t,sc(n,function(r){r.marks&&(t=r.marks(e,n,t))})}),t}function mc(e,t,n){var r=[];var i=fe(t,function(t){var i=le(t),o=e.getSelectionComponent(i,t),a=u(i+lc);if(o.timeUnit){var c=n||e.component.data.raw,s=o.timeUnit.clone();c.parent?s.insertAsParentOf(c):c.parent=s}return"none"!==o.empty&&r.push(a),vc(o.type).predicate+"("+a+", datum"+("global"===o.resolve?")":", "+u(o.resolve)+")")});return(r.length?"!("+r.map(function(e){return"length(data("+e+"))"}).join(" || ")+") || ":"")+"("+i+")"}function gc(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i,vc(i.type))}}function vc(e){switch(e){case"single":return tc;case"multi":return ec;case"interval":return Ku}return null}function yc(e){for(var t=e.parent;t&&!Hu(t);)t=t.parent;return t}function bc(e){var t=u(e.name),n=yc(e);return n&&(t+=(n.facet.row?" + '_' + ("+he(n.vgField("row"),"facet")+")":"")+(n.facet.column?" + '_' + ("+he(n.vgField("column"),"facet")+")":"")),t}function xc(e){var t=!1;return gc(e,function(e){t=t||e.project.some(function(e){return e.field===Ci})}),t}function Sc(e,t,n){var r=e._signalNames||(e._signalNames={});if(r[t]&&r[t][n])return r[t][n];r[t]=r[t]||{};for(var i=le(e.name+"_"+("visual"===n?t:e.fields[t])),o=i,a=1;r[o];)o=i+"_"+a++;return r[o]=r[t][n]=o}function Ec(e){var t=null,n=null,r=null,i=null;return e.project.forEach(function(e,o){e.channel===Ue?(t=e,n=o):e.channel===Pe&&(r=e,i=o)}),{x:t,xi:n,y:r,yi:i}}function wc(e){return e&&!!e.field&&void 0!==e.equal}function kc(e){return e&&!!e.field&&void 0!==e.lt}function Nc(e){return e&&!!e.field&&void 0!==e.lte}function Oc(e){return e&&!!e.field&&void 0!==e.gt}function _c(e){return e&&!!e.field&&void 0!==e.gte}function Tc(e){return!!(e&&e.field&&i(e.range)&&2===e.range.length)}function Cc(e){return e&&!!e.field&&(i(e.oneOf)||i(e.in))}function Ac(e){return Cc(e)||wc(e)||Tc(e)||kc(e)||Oc(e)||Nc(e)||_c(e)}function Dc(e,t,n){return fe(t,function(t){return a(t)?t:function(e){return e&&e.selection}(t)?mc(e,t.selection,n):zc(t)})}function Ic(e,t){return Nr(e,{timeUnit:t,time:!0})}function zc(e,t){void 0===t&&(t=!0);var n=e.field,r=e.timeUnit,i=r?"time("+Fn(r,n)+")":or(e,{expr:"datum"});if(wc(e))return i+"==="+Ic(e.equal,r);if(kc(e))return i+"<"+Ic(u=e.lt,r);if(Oc(e))return i+">"+Ic(a=e.gt,r);if(Nc(e))return i+"<="+Ic(u=e.lte,r);if(_c(e))return i+">="+Ic(a=e.gte,r);if(Cc(e)){var o=e.oneOf;return"indexof(["+function(e,t){return e.map(function(e){return Ic(e,t)})}(o=o||e.in,r).join(",")+"], "+i+") !== -1"}if(Tc(e)){var a=e.range[0],u=e.range[1];if(null!==a&&null!==u&&t)return"inrange("+i+", ["+Ic(a,r)+", "+Ic(u,r)+"])";var c=[];return null!==a&&c.push(i+" >= "+Ic(a,r)),null!==u&&c.push(i+" <= "+Ic(u,r)),c.length>0?c.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(e))}function Rc(e){return Ac(e)&&e.timeUnit?x({},e,{timeUnit:Un(e.timeUnit)}):e}function Lc(e){return void 0!==e.filter}function Fc(e){return void 0!==e.lookup}function jc(e){return void 0!==e.window}function Uc(e){return void 0!==e.calculate}function Pc(e){return!!e.bin}function Mc(e){return void 0!==e.timeUnit}function Hc(e){return void 0!==e.aggregate}function qc(e){return void 0!==e.stack}function Wc(e){return e.map(function(e){return Lc(e)?{filter:function e(t,n){return G(t)?{not:e(t.not,n)}:W(t)?{and:t.and.map(function(t){return e(t,n)})}:q(t)?{or:t.or.map(function(t){return e(t,n)})}:n(t)}(e.filter,Rc)}:e})}var Gc=Object.freeze({isFilter:Lc,isLookup:Fc,isWindow:jc,isCalculate:Uc,isBin:Pc,isTimeUnit:Mc,isAggregate:Hc,isStack:qc,normalizeTransform:Wc});function Bc(e,t){var n;n=function(e){return"as"in e}(e)?a(e.as)?[e.as,e.as+"_end"]:[e.as[0],e.as[1]]:[or(e,{}),or(e,{binSuffix:"end"})];var r=xr(e.bin,void 0)||{},i=function(e,t){return Tt(e)+"_"+t}(r,e.field),o=function(e,t){return{signal:e.getName(t+"_bins"),extentSignal:e.getName(t+"_extent")}}(t,i),u=o.signal,c=o.extentSignal;return{key:i,binComponent:x({bin:r,field:e.field,as:n},u?{signal:u}:{},c?{extentSignal:c}:{})}}var Yc=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bins=n,r}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this.bins))},t.makeFromEncoding=function(e,n){var r=n.reduceFieldDef(function(e,t,r){if(t.bin){var i=Bc(t,n),o=i.key,a=i.binComponent;e[o]=x({},a,e[o],function(e,t,n,r){if(Oa(t,n)){var i=Mu(e)&&(e.axis(n)||e.legend(n))||{},o=or(t,{expr:"datum"}),a=or(t,{expr:"datum",binSuffix:"end"});return{formulaAs:or(t,{binSuffix:"range"}),formula:xa(o,a,i.format,r)}}return{}}(n,t,r,n.config))}return e},{});return 0===oe(r).length?null:new t(e,r)},t.makeFromTransform=function(e,n,r){var i,o=Bc(n,r),a=o.key,u=o.binComponent;return new t(e,((i={})[a]=u,i))},t.prototype.merge=function(e){this.bins=x({},this.bins,e.bins),e.remove()},t.prototype.producedFields=function(){var e={};return ae(this.bins).forEach(function(t){t.as.forEach(function(t){return e[t]=!0})}),e},t.prototype.dependentFields=function(){var e={};return ae(this.bins).forEach(function(t){e[t.field]=!0}),e},t.prototype.assemble=function(){return $(ae(this.bins).map(function(e){var t=[],n=x({type:"bin",field:e.field,as:e.as,signal:e.signal},e.bin);return!e.bin.extent&&e.extentSignal&&(t.push({type:"extent",field:e.field,signal:e.extentSignal}),n.extent={signal:e.extentSignal}),t.push(n),e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))},t}(Ta),Vc=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.model=n,i.filter=r,i.expr=Dc(i.model,i.filter,i),i}return b(t,e),t.prototype.clone=function(){return new t(null,this.model,ce(this.filter))},t.prototype.assemble=function(){return{type:"filter",expr:this.expr}},t}(Ta),Xc=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.fields=n,o.geojson=r,o.signal=i,o}return b(t,e),t.prototype.clone=function(){return new t(null,ce(this.fields),this.geojson,this.signal)},t.parseAll=function(e,n){var r=0;if([[Ge,qe],[Be,We]].forEach(function(i){var o=i.map(function(e){return n.channelHasField(e)?n.fieldDef(e).field:void 0});(o[0]||o[1])&&(e=new t(e,o,null,n.getName("geojson_"+r++)))}),n.channelHasField(Xe)){var i=n.fieldDef(Xe);i.type===Yn&&(e=new t(e,null,i.field,n.getName("geojson_"+r++)))}return e},t.prototype.assemble=function(){return x({type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})},t}(Ta),Qc=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.projection=n,o.fields=r,o.as=i,o}return b(t,e),t.prototype.clone=function(){return new t(null,this.projection,ce(this.fields),ce(this.as))},t.parseAll=function(e,n){return n.projectionName()?([[Ge,qe],[Be,We]].forEach(function(r){var i=r.map(function(e){return n.channelHasField(e)?n.fieldDef(e).field:void 0}),o=r[0]===Be?"2":"";(i[0]||i[1])&&(e=new t(e,n.projectionName(),i,[n.getName("x"+o),n.getName("y"+o)]))}),e):e},t.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}},t}(Ta),Kc=function(e){function t(t){return e.call(this,t)||this}return b(t,e),t.prototype.clone=function(){return new t(null)},t.prototype.producedFields=function(){var e;return(e={})[Ci]=!0,e},t.prototype.assemble=function(){return{type:"identifier",as:Ci}},t}(Ta),Jc=function(e){function t(t,n,r){void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r=!1);var i=e.call(this,t,n)||this;return i.explicit=t,i.implicit=n,i.parseNothing=r,i}return b(t,e),t.prototype.clone=function(){var t=e.prototype.clone.call(this);return t.parseNothing=this.parseNothing,t},t}(Wa),Zc=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.transform=n,i.secondary=r,i}return b(t,e),t.make=function(e,n,r,i){var o=n.component.data.sources,a=new du(r.from.data),u=o[a.hash()];u||(o[a.hash()]=a,u=a);var c=n.getName("lookup_"+i),s=new Ca(u,c,"lookup",n.component.data.outputNodeRefCounts);return n.component.data.outputNodes[c]=s,new t(e,r,s.getSource())},t.prototype.producedFields=function(){return v(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},t.prototype.assemble=function(){var e;if(this.transform.from.fields)e=x({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var t=this.transform.as;a(t)||(fn(Zt.NO_FIELDS_NEEDS_AS),t="_lookup"),e={as:[t]}}return x({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e,this.transform.default?{default:this.transform.default}:{})},t}(Ta);function $c(e){var t=0;return function n(r,i){r instanceof du&&(so(r.data)||(e.push(i),i={name:null,source:i.name,transform:[]}));if(r instanceof fu&&(r.parent instanceof du&&!i.source?(i.format=x({},i.format||{},{parse:r.assembleFormatParse()}),i.transform=i.transform.concat(r.assembleTransforms(!0))):i.transform=i.transform.concat(r.assembleTransforms())),r instanceof su)return i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source,void r.assemble().forEach(function(t){return e.push(t)});(r instanceof Vc||r instanceof Aa||r instanceof Qc||r instanceof Xc||r instanceof cu||r instanceof Zc||r instanceof fs||r instanceof Kc)&&i.transform.push(r.assemble()),(r instanceof lu||r instanceof Yc||r instanceof pu||r instanceof yu)&&(i.transform=i.transform.concat(r.assemble())),r instanceof cu&&(i.name||(i.name="data_"+t++)),r instanceof Ca&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof Ca?r.setSource(i.name):(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]})));switch(r.numChildren()){case 0:r instanceof Ca&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:i.name||(i.name="data_"+t++);var o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source,r.children.forEach(function(e){n(e,{name:null,source:o,transform:[]})})}}}function es(e){ns(e);var t=e.component.layoutSize;t.setWithExplicit("width",rs(e,"width")),t.setWithExplicit("height",rs(e,"height"))}var ts=es;function ns(e){for(var t=0,n=e.children;t<n.length;t++){n[t].parseLayoutSize()}}function rs(e,t){for(var n,r="width"===t?"x":"y",i=e.component.resolve,o=0,a=e.children;o<a.length;o++){var u=(f=a[o]).component.layoutSize.getWithExplicit(t),c=i.scale[r];if("independent"===c&&"range-step"===u.value){n=void 0;break}if(n){if("independent"===c&&n.value!==u.value){n=void 0;break}n=Xa(n,u,t,"")}else n=u}if(n){for(var s=0,l=e.children;s<l.length;s++){var f=l[s];e.renameLayoutSize(f.getName(t),e.getName(t)),f.component.layoutSize.set(t,"merged",!1)}return n}return{explicit:!1,value:void 0}}function is(e,t){var n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){var o=i.get("type"),a=i.get("range");return di(o)&&Ro(a)?"range-step":r.view[t]}return e.hasProjection?r.view[t]:"width"===t&&"text"===e.mark?r.scale.textXRangeStep:r.scale.rangeStep||gi.rangeStep}function os(e,t){return Kn(e.field)?e.field.repeat in t?x({},e,{field:t[e.field.repeat]}):void fn(Zt.noSuchRepeatedValue(e.field.repeat)):e}function as(e,t){if(void 0!==(e=os(e,t))){if(e.sort&&Wo(e.sort)){var n=os(e.sort,t);e=x({},e,n?{sort:n}:{})}return e}}function us(e,t){if(!tr(e)){if($n(e)){if(n=as(e.condition,t))return x({},e,{condition:n});e.condition;return S(e,["condition"])}return e}var n;return(n=as(e,t))?n:Zn(e)?{condition:e.condition}:void 0}function cs(e,t){var n={};for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];if(i(o))n[r]=o.map(function(e){return us(e,t)}).filter(function(e){return e});else{var a=us(o,t);a&&(n[r]=a)}}return n}function ss(e,t,n){return or(t,{expr:n,suffix:"by_"+or(e)})}var ls=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,r,o,i,t.resolve)||this;a.type="facet",a.child=zs(t.spec,a,a.getName("child"),void 0,i,o,!1),a.children=[a.child];var u=function(e,t){return cs(e,t)}(t.facet,i);return a.facet=a.initFacet(u),a}return b(t,e),t.prototype.initFacet=function(e){return Rr(e,function(e,t,n){return Q([Ye,Ve],n)?void 0===t.field?(fn(Zt.emptyFieldDef(t,n)),e):(e[n]=yr(t,n),e):(fn(Zt.incompatibleChannel(n,"facet")),e)},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.component.data=ds(this),this.child.parseData()},t.prototype.parseLayoutSize=function(){ns(this)},t.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},t.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},t.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},t.prototype.parseHeader=function(e){if(this.channelHasField(e)){var t=this.facet[e],n=t.header||{},r=void 0!==t.title?t.title:void 0!==n.title?n.title:mr(t,this.config);this.child.component.layoutHeaders[e].title&&(r+=" / "+this.child.component.layoutHeaders[e].title,this.child.component.layoutHeaders[e].title=null),this.component.layoutHeaders[e]={title:r,facetFieldDef:t,header:[this.makeHeaderComponent(e,!0)]}}},t.prototype.makeHeaderComponent=function(e,t){var n="row"===e?"height":"width";return{labels:t,sizeSignal:this.child.component.layoutSize.get(n)?this.child.getSizeSignalRef(n):void 0,axes:[]}},t.prototype.mergeChildAxis=function(e){var t,n=this.child;if(n.component.axes[e]){var r=this.component,i=r.layoutHeaders,o=r.resolve;if(o.axis[e]=qa(o,e),"shared"===o.axis[e])for(var a="x"===e?"column":"row",u=i[a],c=0,s=n.component.axes[e];c<s.length;c++){var l=s[c],f="top"===(t=l.get("orient"))||"left"===t?"header":"footer";u[f]=u[f]||[this.makeHeaderComponent(a,!1)];var d=jo(l,"main",this.config,{header:!0});u[f][0].axes.push(d),l.mainExtracted=!0}}},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.child.assembleSelectionTopLevelSignals(e)},t.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},t.prototype.assembleSelectionData=function(e){return this.child.assembleSelectionData(e)},t.prototype.getHeaderLayoutMixins=function(){var e=this,t={};return["row","column"].forEach(function(n){["header","footer"].forEach(function(r){var i=e.component.layoutHeaders[n],o=i[r];if(o&&o[0]){var a="row"===n?"height":"width",u="header"===r?"headerBand":"footerBand";e.child.component.layoutSize.get(a)||(t[u]=t[u]||{},t[u][n]=.5),i.title&&(t.offset=t.offset||{},t.offset["row"===n?"rowTitle":"columnTitle"]=10)}})}),t},t.prototype.assembleDefaultLayout=function(){var e=this.channelHasField("column")?this.columnDistinctSignal():1;return x({},this.getHeaderLayoutMixins(),{columns:e,bounds:"full",align:"all"})},t.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},t.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof t))return{signal:"length(data('"+this.getName("column_domain")+"'))"}},t.prototype.assembleGroup=function(n){return this.parent&&this.parent instanceof t?x({},this.channelHasField("column")?{encode:{update:{columns:{field:or(this.facet.column,{prefix:"distinct"})}}}}:{},e.prototype.assembleGroup.call(this,n)):e.prototype.assembleGroup.call(this,n)},t.prototype.getCardinalityAggregateForChild=function(){var e=[],n=[],r=[];if(this.child instanceof t){if(this.child.channelHasField("column")){var i=or(this.child.facet.column);e.push(i),n.push("distinct"),r.push("distinct_"+i)}}else for(var o=0,a=["x","y"];o<a.length;o++){var u=a[o],c=this.child.component.scales[u];if(c&&!c.merged){var s=c.get("type"),l=c.get("range");if(di(s)&&Ro(l))(i=Ou(_u(this.child,u)))?(e.push(i),n.push("distinct"),r.push("distinct_"+i)):fn("Unknown field for ${channel}.  Cannot calculate view size.")}}return{fields:e,ops:n,as:r}},t.prototype.assembleFacet=function(){var e=this,t=this.component.data.facetRoot,n=t.name,r=t.data,o=this.facet,a=o.row,u=o.column,c=this.getCardinalityAggregateForChild(),s=c.fields,l=c.ops,f=c.as,d=[];["row","column"].forEach(function(t){var n=e.facet[t];if(n){d.push(or(n));var r=n.sort;if(Wo(r)){var o=r.field,c=r.op,p=ss(n,r);a&&u?(s.push(p),l.push("max"),f.push(p)):(s.push(o),l.push(c),f.push(p))}else if(i(r)){p=Da(n,t);s.push(p),l.push("max"),f.push(p)}}});var p=!!a&&!!u;return x({name:n,data:r,groupby:d},p||s.length?{aggregate:x({},p?{cross:p}:{},s.length?{fields:s,ops:l,as:f}:{})}:{})},t.prototype.headerSortFields=function(e){var t=this.facet[e];return t?Wo(t.sort)?[ss(t,t.sort,"datum")]:i(t.sort)?[Da(t,e,"datum")]:[or(t,{expr:"datum"})]:[]},t.prototype.headerSortOrder=function(e){var t=this.facet[e];if(t){var n=t.sort;return[(Wo(n)?n.order:!i(n)&&n)||"ascending"]}return[]},t.prototype.assembleMarks=function(){var e=this.child,t=function(e){var t=[],n=$c(t);return e.children.forEach(function(t){return n(t,{source:e.name,name:null,transform:[]})}),t}(this.component.data.facetRoot),n=e.assembleLayoutSize(),r=e.assembleTitle(),i=e.assembleGroupStyle();return[x({name:this.getName("cell"),type:"group"},r?{title:r}:{},i?{style:i}:{},{from:{facet:this.assembleFacet()},sort:{field:this.headerSortFields("row").concat(this.headerSortFields("column")),order:this.headerSortOrder("row").concat(this.headerSortOrder("column"))}},t.length>0?{data:t}:{},n?{encode:{update:n}}:{},e.assembleGroup())]},t.prototype.getMapping=function(){return this.facet},t}(Yu),fs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.transform=n,r}return b(t,e),t.makeFromFacet=function(e,n){var r=n.row,i=n.column;if(r&&i){for(var o=null,a=0,u=[r,i];a<u.length;a++){var c=u[a];if(Wo(c.sort)){var s=c.sort,l=s.field;e=o=new t(e,{window:[{op:s.op,field:l,as:ss(c,c.sort)}],groupby:[or(c)],frame:[null,null]})}}return o}return null},t.prototype.clone=function(){return new t(this.parent,ce(this.transform))},t.prototype.producedFields=function(){var e=this,t={};return this.transform.window.forEach(function(n){t[e.getDefaultName(n)]=!0}),t},t.prototype.getDefaultName=function(e){return e.as||or(e)},t.prototype.assemble=function(){for(var e=[],t=[],n=[],r=[],i=0,o=this.transform.window;i<o.length;i++){var a=o[i];t.push(a.op),n.push(this.getDefaultName(a)),r.push(void 0===a.param?null:a.param),e.push(void 0===a.field?null:a.field)}var u=this.transform.frame,c=this.transform.groupby,s=[],l=[];if(void 0!==this.transform.sort)for(var f=0,d=this.transform.sort;f<d.length;f++){var p=d[f];s.push(p.field),l.push(p.order||"ascending")}var h={field:s,order:l},m=this.transform.ignorePeers,g={type:"window",params:r,as:n,ops:t,fields:e,sort:h};return void 0!==m&&(g.ignorePeers=m),void 0!==c&&(g.groupby=c),void 0!==u&&(g.frame=u),g},t}(Ta);function ds(e){var t=function(e,t){if(e.data||!e.parent){var n=new du(e.data),r=n.hash();return r in t?t[r]:(t[r]=n,n)}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources),n=e.component.data,r=n.outputNodes,i=n.outputNodeRefCounts,o=e.parent?e.parent.component.data.ancestorParse.clone():new Jc;e.data&&e.data.format&&null===e.data.format.parse&&(o.parseNothing=!0),t=fu.makeExplicit(t,e,o)||t,xc(e)&&(Mu(e)||Gu(e))&&(t=new Kc(t));var a=e.parent&&Gu(e.parent);(Mu(e)||Hu(e))&&a&&(t=Yc.makeFromEncoding(t,e)||t),e.transforms.length>0&&(t=function(e,t,n){var r=0;return t.transforms.forEach(function(i){if(Uc(i))e=new Aa(e,i),n.set(i.as,"derived",!1);else if(Lc(i))e=fu.makeImplicitFromFilterTransform(e,i,n)||e,e=new Vc(e,t,i.filter);else if(Pc(i))for(var o=e=Yc.makeFromTransform(e,i,t),a=0,u=oe(o.producedFields());a<u.length;a++){var c=u[a];n.set(c,"number",!1)}else if(Mc(i))e=pu.makeFromTransform(e,i),n.set(i.as,"date",!1);else if(Hc(i)){var s=e=cu.makeFromTransform(e,i);xc(t)&&(e=new Kc(e));for(var l=0,f=oe(s.producedFields());l<f.length;l++)c=f[l],n.set(c,"derived",!1)}else if(Fc(i))for(var d=e=Zc.make(e,t,i,r++),p=0,h=oe(d.producedFields());p<h.length;p++)c=h[p],n.set(c,"derived",!1);else if(jc(i))for(var m=e=new fs(e,i),g=0,v=oe(m.producedFields());g<v.length;g++)c=v[g],n.set(c,"derived",!1);else{if(!qc(i))return void fn(Zt.invalidTransformIgnored(i));for(var y=e=yu.makeFromTransform(e,i),b=0,x=oe(y.producedFields());b<x.length;b++)c=x[b],n.set(c,"derived",!1)}}),e}(t,e,o)),t=fu.makeImplicitFromEncoding(t,e,o)||t,Mu(e)&&(t=Xc.parseAll(t,e),t=Qc.parseAll(t,e)),(Mu(e)||Hu(e))&&(a||(t=Yc.makeFromEncoding(t,e)||t),t=pu.makeFromEncoding(t,e)||t,t=Aa.parseAllForSortIndex(t,e));var u=e.getName(ho),c=new Ca(t,u,ho,i);if(r[u]=c,t=c,Mu(e)){var s=cu.makeFromEncoding(t,e);s&&(t=s,xc(e)&&(t=new Kc(t))),t=yu.makeFromEncoding(t,e)||t}Mu(e)&&(t=lu.make(t,e)||t);var l=e.getName(po),f=new Ca(t,l,po,i);r[l]=f,t=f;var d=null;if(Hu(e)){var p=e.getName("facet");t=Aa.parseAllForSortIndex(t,e),t=fs.makeFromFacet(t,e.facet)||t,d=new su(t,e,p,f.getSource()),r[p]=d,t=d}return x({},e.component.data,{outputNodes:r,outputNodeRefCounts:i,raw:c,main:f,facetRoot:d,ancestorParse:o})}var ps=function(e){function t(t,n,r,i,o,a){return e.call(this,t,n,r,i,o,a)||this}return b(t,e),t.prototype.parseData=function(){this.component.data=ds(this),this.children.forEach(function(e){e.parseData()})},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=function(t){t.parseSelection(),oe(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})},n=0,r=this.children;n<r.length;n++){t(r[n])}},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},t.prototype.parseAxisAndHeader=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseAxisAndHeader()}},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(e){return e.assembleSelectionSignals()}),[]},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},Ua(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},t.prototype.assembleMarks=function(){return this.children.map(function(e){var t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleLayoutSize();return x({type:"group",name:e.getName("group")},t?{title:t}:{},n?{style:n}:{},r?{encode:{update:r}}:{},e.assembleGroup())})},t}(Bu),hs=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,r,o,i,t.resolve)||this;return a.type="concat",t.resolve&&t.resolve.axis&&("shared"===t.resolve.axis.x||"shared"===t.resolve.axis.y)&&fn(Zt.CONCAT_CANNOT_SHARE_AXIS),a.isVConcat=Ji(t),a.children=(Ji(t)?t.vconcat:t.hconcat).map(function(e,t){return zs(e,a,a.getName("concat_"+t),void 0,i,o,!1)}),a}return b(t,e),t.prototype.parseLayoutSize=function(){!function(e){ns(e);var t=e.component.layoutSize,n=e.isVConcat?"width":"height";t.setWithExplicit(n,rs(e,n))}(this)},t.prototype.parseAxisGroup=function(){return null},t.prototype.assembleDefaultLayout=function(){return x({},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},t}(ps);var ms=function(e){function t(t,n,r){void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r=!1);var i=e.call(this)||this;return i.explicit=t,i.implicit=n,i.mainExtracted=r,i}return b(t,e),t.prototype.clone=function(){return new t(ce(this.explicit),ce(this.implicit),this.mainExtracted)},t.prototype.hasAxisPart=function(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t},t}(Wa);function gs(e,t,n,r,i){void 0===r&&(r="");for(var o=0,a=("band"===i?["axisBand"]:[]).concat(["x"===n?"axisX":"axisY","axis"+r.substr(0,1).toUpperCase()+r.substr(1),"axis"]);o<a.length;o++){var u=a[o];if(t[u]&&void 0!==t[u][e])return t[u][e]}}function vs(e,t,n,r){var i=e.fieldDef(t)||("x"===t?e.fieldDef("x2"):"y"===t?e.fieldDef("y2"):void 0),o=e.axis(t),a=e.config,u={};if(kr(i)){var c=e.getScaleComponent(t).get("type")===Br.UTC,s=Sa("datum.value",i.timeUnit,o.format,a.axis.shortTimeLabels,a.timeFormat,c);s&&(u.text={signal:s})}var l=gs("labelAngle",e.config,t,r,e.getScaleComponent(t).get("type"));if(void 0===l&&(l=function(e,t,n){if(void 0!==e.labelAngle)return(e.labelAngle%360+360)%360;if(t===Ue&&Q([Bn,Wn],n.type))return 270;return}(o,t,i))&&(u.angle={value:l}),void 0!==l){var f=function(e,t){return e=(e%360+360)%360,"top"===t||"bottom"===t?e%180==0?"center":0<e&&e<180?"top"===t?"right":"left":"top"===t?"left":"right":(e+90)%180==0?"center":90<=e&&e<270?"left"===t?"left":"right":"left"===t?"right":"left"}(l,r);f&&(u.align={value:f}),u.baseline=function(e,t){return"top"===t||"bottom"===t?e<=45||315<=e?{value:"top"===t?"bottom":"top"}:135<=e&&e<=225?{value:"top"===t?"top":"bottom"}:{value:"middle"}:e<=45||315<=e||135<=e&&e<=225?{value:"middle"}:45<=e&&e<=135?{value:"left"===t?"top":"bottom"}:{value:"left"===t?"bottom":"top"}}(l,r)}return u=x({},u,n),0===oe(u).length?void 0:u}function ys(e){return yt.reduce(function(t,n){return e.component.scales[n]&&e.axis(n)&&(t[n]=[function(e,t){var n=t.axis(e),r=new ms;Le.forEach(function(i){var o=function(e,t,n,r){var i=r.fieldDef(n);switch(e){case"scale":return r.scaleName(n);case"gridScale":return function(e,t){var n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(r,n);case"format":return va(i,t.format,r.config);case"grid":var o=r.getScaleComponent(n).get("type");return ga(t.grid,function(e,t){return!di(e)&&!t.bin}(o,i));case"labelFlush":return function(e,t,n){return void 0!==n.labelFlush?n.labelFlush:!("x"!==t||!Q(["quantitative","temporal"],e.type))||void 0}(i,n,t);case"labelOverlap":var o=r.getScaleComponent(n).get("type");return function(e,t,n,r){return void 0!==t.labelOverlap?t.labelOverlap:"nominal"!==e.type?"log"!==r||"greedy":void 0}(i,t,0,o);case"orient":return ga(t.orient,function(e){switch(e){case Ue:return"bottom";case Pe:return"left"}throw new Error(Zt.INVALID_CHANNEL_FOR_AXIS)}(n));case"tickCount":var o=r.getScaleComponent(n).get("type"),a="x"===n?"width":"y"===n?"height":void 0,u=a?r.getSizeSignalRef(a):void 0;return ga(t.tickCount,function(e,t,n,r){if(!di(n)&&"log"!==n&&!Q(["month","hours","day","quarter"],t.timeUnit))return t.bin?{signal:"ceil("+r.signal+"/20)"}:{signal:"ceil("+r.signal+"/40)"}}(0,i,o,u));case"title":var c="x"===n?"x2":"y2",s=r.fieldDef(c),l=Es(r,n),f=void 0!==l?l:void 0===t.title?void 0:t.title;return ga(f,wa([Jn(i)],s?[Jn(s)]:[]));case"values":return function(e,t,n,r){var i=e.values;if(i)return Or(n,i);if(n.bin&&n.type===qn){var o=t.scaleDomain(r);if(o&&"unaggregated"!==o&&!yi(o))return;var a=t.getName(Tt(n.bin)+"_"+n.field+"_bins");return{signal:"sequence("+a+".start, "+a+".stop + "+a+".step, "+a+".step)"}}}(t,r,i,n)}return ze(e)?t[e]:void 0}(i,n,e,t);if(void 0!==o){var a="values"===i?!!n.values:"encode"===i?!!n.encoding||!!n.labelAngle:"title"===i&&o===Es(t,e)||o===n[i],u=gs(i,t.config,e,r.get("orient"),t.getScaleComponent(e).get("type"));a||void 0===u?r.set(i,o,a):"grid"===i&&u&&r.set(i,u,!1)}});var i=n.encoding||{},o=Ce.reduce(function(n,o){if(!r.hasAxisPart(o))return n;var a=_a(i[o]||{},t),u="labels"===o?vs(t,e,a,r.get("orient")):a;return void 0!==u&&oe(u).length>0&&(n[o]={update:u}),n},{});oe(o).length>0&&r.set("encode",o,!!n.encoding||void 0!==n.labelAngle);return r}(n,e)]),t},{})}var bs={bottom:"top",top:"bottom",left:"right",right:"left"};function xs(e,t){if(!e)return t.map(function(e){return e.clone()});if(e.length===t.length){for(var n=e.length,r=0;r<n;r++){var i=e[r],o=t[r];if(!!i!=!!o)return;if(i&&o){var a=i.getWithExplicit("orient"),u=o.getWithExplicit("orient");if(a.explicit&&u.explicit&&a.value!==u.value)return;e[r]=Ss(i,o)}}return e}}function Ss(e,t){for(var n=function(n){var r=Xa(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",function(e,t){switch(n){case"title":return Na(e,t);case"gridScale":return{explicit:e.explicit,value:e.value||t.value}}return Va(e,t,n,"axis")});e.setWithExplicit(n,r)},r=0,i=Le;r<i.length;r++){n(i[r])}return e}function Es(e,t){var n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),o=r?r.title:void 0,a=i?i.title:void 0;return o&&a?ka(o,a):o||(a||(void 0!==o?o:void 0!==a?a:void 0))}function ws(e,t,n){var r=Xt(e)?x({},e):{type:e},i=r.orient||ha("orient",r,n);return r.orient=function(e,t,n){switch(e){case Ft:case Wt:case Gt:case jt:case Mt:return}var r=t.y2,i=t.x2;switch(e){case Rt:if(r||i){if(n)return n;var o=t.x;if(!i&&tr(o)&&o.type===qn&&!o.bin)return"horizontal";var a=t.y;if(!r&&tr(a)&&a.type===qn&&!a.bin)return"vertical"}case Ht:if(i&&r)return;case zt:if(r)return"vertical";if(i)return"horizontal";if(e===Ht){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case Lt:case Ut:var u=tr(t.x)&&ur(t.x),c=tr(t.y)&&ur(t.y);if(u&&!c)return"tick"!==e?"horizontal":"vertical";if(!u&&c)return"tick"!==e?"vertical":"horizontal";if(u&&c){var o=t.x,a=t.y,s=o.type===Gn,l=a.type===Gn;return s&&!l?"tick"!==e?"vertical":"horizontal":!s&&l?"tick"!==e?"horizontal":"vertical":!o.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":o.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&fn(Zt.orientOverridden(r.orient,i)),void 0===(void 0!==r.opacity?r.opacity:ha("opacity",r,n))&&(r.opacity=function(e,t){if(Q([Ft,Ut,Wt,Gt],e)&&!Cr(t))return.7;return}(r.type,t)),void 0===r.filled&&(r.filled=function(e,t){var n=ha("filled",e,t),r=e.type;return void 0!==n?n:r!==Ft&&r!==Lt&&r!==Ht}(r,n)),void 0===(r.cursor||ha("cursor",r,n))&&(r.cursor=function(e,t,n){if(t.href||e.href||ha("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function ks(e,t,n,r){if(void 0!==e.size)return{value:e.size};if(r.bar.discreteBandSize)return{value:r.bar.discreteBandSize};if(n){var i=n.get("type");if(i!==Br.POINT)return i===Br.BAND?Qo(t):{value:r.bar.continuousBandSize};var o=n.get("range");if(Ro(o)&&g(o.step))return{value:o.step-1};fn(Zt.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}else if(r.scale.rangeStep&&null!==r.scale.rangeStep)return{value:r.scale.rangeStep-1};return{value:20}}function Ns(e,t){var n=e.config,r=e.width,i=e.height;return x({},ta(e,{size:"include",orient:"ignore"}),fa("x",e,Zo(r)),fa("y",e,Zo(i)),ia("size",e),function(e,t,n){if(n)return{shape:{value:n}};return ia("shape",e,{defaultValue:ha("shape",e.markDef,t)})}(e,n,t))}var Os={area:{vgMark:"area",encodeEntry:function(e){return x({},ta(e,{size:"ignore",orient:"include"}),fa("x",e,"zeroOrMin"),fa("y",e,"zeroOrMin"),da(e,"zeroOrMin","horizontal"===e.markDef.orient?"x2":"y2"),ra(e))}},bar:{vgMark:"rect",encodeEntry:function(e){return x({},ta(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.config,n=e.encoding,r=e.markDef,i=e.width,o=r.orient,a=n.size,u=n.x,c=n.x2,s=e.scaleName(Ue),l=e.getScaleComponent(Ue);if("horizontal"===o||c)return x({},fa("x",e,"zeroOrMin"),da(e,"zeroOrMin","x2"));if(tr(u)){var f=l.get("type");if(u.bin&&!a&&!di(f))return la(u,"x",e.scaleName("x"),void 0===r.binSpacing?t.bar.binSpacing:r.binSpacing,l.get("reverse"));if(f===Br.BAND)return ca(u,"x",e)}return sa("x",e,x({},Zo(i)),ks(r,s,l,t))}(e),function(e){var t=e.config,n=e.encoding,r=e.height,i=e.markDef,o=i.orient,a=n.size,u=n.y,c=n.y2,s=e.scaleName(Pe),l=e.getScaleComponent(Pe);if("vertical"===o||c)return x({},fa("y",e,"zeroOrMin"),da(e,"zeroOrMin","y2"));if(tr(u)){var f=l.get("type");if(u.bin&&!a&&!di(f))return la(u,"y",e.scaleName("y"),void 0===i.binSpacing?t.bar.binSpacing:i.binSpacing,l.get("reverse"));if(f===Br.BAND)return ca(u,"y",e)}return sa("y",e,Zo(r),ks(i,s,l,t))}(e))}},circle:{vgMark:"symbol",encodeEntry:function(e){return Ns(e,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(e){return x({},ta(e,{size:"ignore",orient:"ignore"}))},postEncodingTransform:function(e){var t=e.encoding.shape;return[x({type:"geoshape",projection:e.projectionName()},t&&tr(t)&&t.type===Yn?{field:or(t,{expr:"datum"})}:{})]}},line:{vgMark:"line",encodeEntry:function(e){var t=e.width,n=e.height;return x({},ta(e,{size:"ignore",orient:"ignore"}),fa("x",e,Zo(t)),fa("y",e,Zo(n)),ia("size",e,{vgChannel:"strokeWidth"}),ra(e))}},point:{vgMark:"symbol",encodeEntry:function(e){return Ns(e)}},rect:{vgMark:"rect",encodeEntry:function(e){return x({},ta(e,{size:"ignore",orient:"ignore"}),function(e){var t=e.encoding.x,n=e.encoding.x2,r=e.getScaleComponent(Ue),i=r?r.get("type"):void 0;if(tr(t)&&t.bin&&!n)return la(t,"x",e.scaleName("x"),0,r.get("reverse"));if(tr(t)&&r&&di(i)){if(i===Br.BAND)return ca(t,"x",e);throw new Error(Zt.scaleTypeNotWorkWithMark(Mt,i))}return x({},fa("x",e,"zeroOrMax"),da(e,"zeroOrMin","x2"))}(e),function(e){var t=e.encoding.y,n=e.encoding.y2,r=e.getScaleComponent(Pe),i=r?r.get("type"):void 0;if(tr(t)&&t.bin&&!n)return la(t,"y",e.scaleName("y"),0,r.get("reverse"));if(tr(t)&&r&&di(i)){if(i===Br.BAND)return ca(t,"y",e);throw new Error(Zt.scaleTypeNotWorkWithMark(Mt,i))}return x({},fa("y",e,"zeroOrMax"),da(e,"zeroOrMin","y2"))}(e))}},rule:{vgMark:"rule",encodeEntry:function(e){e.config;var t=e.markDef,n=e.width,r=e.height,i=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?x({},ta(e,{size:"ignore",orient:"ignore"}),fa("x",e,"horizontal"===i?"zeroOrMin":Zo(n)),fa("y",e,"vertical"===i?"zeroOrMin":Zo(r)),"vertical"!==i?da(e,"zeroOrMax","x2"):{},"horizontal"!==i?da(e,"zeroOrMax","y2"):{},ia("size",e,{vgChannel:"strokeWidth",defaultValue:t.size})):{}}},square:{vgMark:"symbol",encodeEntry:function(e){return Ns(e,"square")}},text:{vgMark:"text",encodeEntry:function(e){var t=e.config,n=(e.encoding,e.width),r=e.height,i=e.markDef;return x({},ta(e,{size:"ignore",orient:"ignore"}),fa("x",e,Zo(n)),fa("y",e,Zo(r)),aa(e),ia("size",e,x({},i.size?{defaultValue:i.size}:{},{vgChannel:"fontSize"})),function(e,t){var n;if(void 0!==t)return(n={})[e]={value:t},n}("align",function(e,t,n){if(void 0===(e.align||ha("align",e,n)))return"center";return}(e.markDef,0,t)))}},tick:{vgMark:"rect",encodeEntry:function(e){var t,n=e.config,r=e.markDef,i=e.width,o=e.height,a=r.orient,u="horizontal"===a?"width":"height",c="horizontal"===a?"height":"width";return x({},ta(e,{size:"ignore",orient:"ignore"}),fa("x",e,Zo(i),"xc"),fa("y",e,Zo(o),"yc"),ia("size",e,{defaultValue:function(e){var t=e.config,n=e.markDef,r=n.orient,i=e.getScaleComponent("horizontal"===r?"x":"y");if(void 0!==n.size)return n.size;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var o=i?i.get("range"):void 0,a=o&&Ro(o)?o.step:t.scale.rangeStep;if("number"!=typeof a)throw new Error("Function does not handle non-numeric rangeStep");return a/1.5}(e),vgChannel:u}),((t={})[c]={value:r.thickness||n.tick.thickness},t))}},trail:{vgMark:"trail",encodeEntry:function(e){var t=e.width,n=e.height;return x({},ta(e,{size:"include",orient:"ignore"}),fa("x",e,Zo(t)),fa("y",e,Zo(n)),ia("size",e),ra(e))}}};function _s(e){return Q([Lt,zt,Pt],e.mark)?function(e){var t=(r=e.mark,o=e.encoding,oe(o).reduce(function(e,t){switch(t){case"x":case"y":case"order":case"tooltip":case"href":case"x2":case"y2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case"shape":return e;case"detail":case"key":var n=o[t];return n&&(i(n)?n:[n]).forEach(function(t){t.aggregate||e.push(or(t,{}))}),e;case"size":if("trail"===r)return e;case"color":case"fill":case"stroke":case"opacity":var a=vr(o[t]);return a&&!a.aggregate&&e.push(or(a,{})),e;default:throw new Error("Bug: Channel "+t+" unimplemented for line mark")}},[])),n=Cs(e,{fromPrefix:t.length>0?Ts:""});var r,o;return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:Ts+e.requestDataName(po),data:e.requestDataName(po),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):Cs(e)}var Ts="faceted_path_";function Cs(e,t){void 0===t&&(t={fromPrefix:""});var n=e.mark,r=void 0!==e.markDef.clip?!!e.markDef.clip:function(e){var t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("domainRaw")||n&&n.get("domainRaw"))}(e),o=pa(e.markDef),a=e.encoding.key,u=function(e){var t=e.encoding,n=e.stack,r=e.mark,o=e.markDef,a=t.order;if(i(a)||!rr(a)){if((i(a)||tr(a))&&!n)return Ea(a,{expr:"datum"});if(Yt(r)){var u=t["horizontal"===o.orient?"y":"x"];if(tr(u)){var c=u.sort;return{field:Wo(c)?or({aggregate:Cr(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"}):or(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"}),order:"descending"}}}}}(e),c=Os[n].postEncodingTransform?Os[n].postEncodingTransform(e):null;return[x({name:e.getName("marks"),type:Os[n].vgMark},r?{clip:!0}:{},o?{style:o}:{},a?{key:{field:a.field}}:{},u?{sort:u}:{},{from:{data:t.fromPrefix+e.requestDataName(po)},encode:{update:Os[n].encodeEntry(e)}},c?{transform:c}:{})]}var As=function(e){function t(t,n,r,i,o,a,u){void 0===i&&(i={});var c=e.call(this,t,n,r,a,o,void 0)||this;c.fit=u,c.type="unit",c.specifiedScales={},c.specifiedAxes={},c.specifiedLegends={},c.specifiedProjection={},c.selection={},c.children=[],c.initSize(x({},i,t.width?{width:t.width}:{},t.height?{height:t.height}:{}));var s=Xt(t.mark)?t.mark.type:t.mark,l=c.encoding=Ar(function(e,t){return cs(e,t)}(t.encoding||{},o),s);return c.markDef=ws(t.mark,l,a),c.stack=Gi(s,l,c.config.stack),c.specifiedScales=c.initScales(s,l),c.specifiedAxes=c.initAxes(l),c.specifiedLegends=c.initLegend(l),c.specifiedProjection=t.projection,c.selection=t.selection,c}return b(t,e),Object.defineProperty(t.prototype,"hasProjection",{get:function(){var e=this.encoding,t=this.mark===qt,n=e&&ut.some(function(t){return tr(e[t])});return t||n},enumerable:!0,configurable:!0}),t.prototype.scaleDomain=function(e){var t=this.specifiedScales[e];return t?t.domain:void 0},t.prototype.axis=function(e){return this.specifiedAxes[e]},t.prototype.legend=function(e){return this.specifiedLegends[e]},t.prototype.initScales=function(e,t){return Et.reduce(function(e,n){var r,i,o=t[n];return tr(o)?(r=o,i=o.scale):$n(o)?(r=o.condition,i=o.condition.scale):"x"===n?r=vr(t.x2):"y"===n&&(r=vr(t.y2)),r&&(e[n]=i||{}),e},{})},t.prototype.initAxes=function(e){return[Ue,Pe].reduce(function(t,n){var r=e[n];if(tr(r)||n===Ue&&tr(e.x2)||n===Pe&&tr(e.y2)){var i=tr(r)?r.axis:null;null!==i&&!1!==i&&(t[n]=x({},i))}return t},{})},t.prototype.initLegend=function(e){return xt.reduce(function(t,n){var r=e[n];if(r){var i=tr(r)?r.legend:$n(r)?r.condition.legend:null;null!==i&&!1!==i&&(t[n]=x({},i))}return t},{})},t.prototype.parseData=function(){this.component.data=ds(this)},t.prototype.parseLayoutSize=function(){!function(e){var t=e.component.layoutSize;if(!t.explicit.width){var n=is(e,"width");t.set("width",n,!1)}if(!t.explicit.height){var r=is(e,"height");t.set("height",r,!1)}}(this)},t.prototype.parseSelection=function(){this.component.selection=function(e,t){var n={},r=e.config.selection,i=function(i){if(!t.hasOwnProperty(i))return"continue";var o=t[i],u=r[o.type];for(var c in u)"encodings"===c&&o.fields||"fields"===c&&o.encodings||("mark"===c&&(o[c]=x({},u[c],o[c])),void 0!==o[c]&&!0!==o[c]||(o[c]=u[c]||o[c]));i=le(i);var s=n[i]=x({},o,{name:i,events:a(o.on)?go(o.on,"scope"):o.on});sc(s,function(t){t.parse&&t.parse(e,o,s)})};for(var o in t)i(o);return n}(this,this.selection)},t.prototype.parseMarkGroup=function(){this.component.mark=_s(this)},t.prototype.parseAxisAndHeader=function(){this.component.axes=ys(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return n=e,r=!1,gc(t=this,function(e,i){i.topLevelSignals&&(n=i.topLevelSignals(t,e,n)),sc(e,function(r){r.topLevelSignals&&(n=r.topLevelSignals(t,e,n))}),r=!0}),r&&(n.filter(function(e){return"unit"===e.name}).length||n.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),n;var t,n,r},t.prototype.assembleSelectionSignals=function(){return function(e,t){gc(e,function(n,r){var i=n.name,o=r.modifyExpr(e,n);t.push.apply(t,r.signals(e,n)),sc(n,function(r){r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(o=r.modifyExpr(e,n,o))}),t.push({name:i+dc,on:[{events:{signal:i+fc},update:"modify("+u(n.name+lc)+", "+o+")"}]})});var n=yc(e);if(t.length&&n){var r=u(n.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:go("mousemove","scope"),update:"isTuple(facet) ? facet : group("+r+").datum"}]})}return t}(this,[])},t.prototype.assembleSelectionData=function(e){return function(e,t){return gc(e,function(e){t.filter(function(t){return t.name===e.name+lc}).length||t.push({name:e.name+lc})}),t}(this,e)},t.prototype.assembleLayout=function(){return null},t.prototype.assembleLayoutSignals=function(){return Ua(this)},t.prototype.assembleMarks=function(){var e=this.component.mark||[];return this.parent&&Gu(this.parent)||(e=hc(this,e)),e.map(this.correctDataNames)},t.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,r=ce(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=ce(this.config)),t||(n.data=ce(this.data)),n},Object.defineProperty(t.prototype,"mark",{get:function(){return this.markDef.type},enumerable:!0,configurable:!0}),t.prototype.channelHasField=function(e){return Tr(this.encoding,e)},t.prototype.fieldDef=function(e){return vr(this.encoding[e])},t}(Yu),Ds=function(e){function t(n,r,i,o,a,u,c){var s=e.call(this,n,r,i,u,a,n.resolve)||this;s.type="layer";var l=x({},o,n.width?{width:n.width}:{},n.height?{height:n.height}:{});return s.initSize(l),s.children=n.layer.map(function(e,n){if(Xi(e))return new t(e,s,s.getName("layer_"+n),l,a,u,c);if(Vi(e))return new As(e,s,s.getName("layer_"+n),l,a,u,c);throw new Error(Zt.INVALID_SPEC)}),s}return b(t,e),t.prototype.parseData=function(){this.component.data=ds(this);for(var e=0,t=this.children;e<t.length;e++){t[e].parseData()}},t.prototype.parseLayoutSize=function(){es(this)},t.prototype.parseSelection=function(){var e=this;this.component.selection={};for(var t=function(t){t.parseSelection(),oe(t.component.selection).forEach(function(n){e.component.selection[n]=t.component.selection[n]})},n=0,r=this.children;n<r.length;n++){t(r[n])}},t.prototype.parseMarkGroup=function(){for(var e=0,t=this.children;e<t.length;e++){t[e].parseMarkGroup()}},t.prototype.parseAxisAndHeader=function(){!function(e){for(var t=e.component,n=t.axes,r=t.resolve,i={top:0,bottom:0,right:0,left:0},o=0,a=e.children;o<a.length;o++){(h=a[o]).parseAxisAndHeader();for(var u=0,c=oe(h.component.axes);u<c.length;u++){var s=c[u];r.axis[s]=qa(e.component.resolve,s),"shared"===r.axis[s]&&(n[s]=xs(n[s],h.component.axes[s]),n[s]||(r.axis[s]="independent",delete n[s]))}}for(var l=0,f=[Ue,Pe];l<f.length;l++){s=f[l];for(var d=0,p=e.children;d<p.length;d++){var h;if((h=p[d]).component.axes[s]){if("independent"===r.axis[s]){n[s]=(n[s]||[]).concat(h.component.axes[s]);for(var m=0,g=h.component.axes[s];m<g.length;m++){var v=g[m],y=v.getWithExplicit("orient"),b=y.value,x=y.explicit;if(i[b]>0&&!x){var S=bs[b];i[b]>i[S]&&v.set("orient",S,!1)}i[b]++}}delete h.component.axes[s]}}}}(this)},t.prototype.assembleSelectionTopLevelSignals=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionTopLevelSignals(e)},e)},t.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleSelectionSignals())},[])},t.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLayoutSignals())},Ua(this))},t.prototype.assembleSelectionData=function(e){return this.children.reduce(function(e,t){return t.assembleSelectionData(e)},e)},t.prototype.assembleTitle=function(){var t=e.prototype.assembleTitle.call(this);if(t)return t;for(var n=0,r=this.children;n<r.length;n++){if(t=r[n].assembleTitle())return t}},t.prototype.assembleLayout=function(){return null},t.prototype.assembleMarks=function(){return e=this,t=$(this.children.map(function(e){return e.assembleMarks()})),e.children.forEach(function(e){Mu(e)&&(t=hc(e,t))}),t;var e,t},t.prototype.assembleLegends=function(){return this.children.reduce(function(e,t){return e.concat(t.assembleLegends())},nu(this))},t}(Bu),Is=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,r,o,i,t.resolve)||this;return a.type="repeat",t.resolve&&t.resolve.axis&&("shared"===t.resolve.axis.x||"shared"===t.resolve.axis.y)&&fn(Zt.REPEAT_CANNOT_SHARE_AXIS),a.repeat=t.repeat,a.children=a._initChildren(t,a.repeat,i,o),a}return b(t,e),t.prototype._initChildren=function(e,t,n,r){for(var i=[],o=t.row||[n?n.row:null],a=t.column||[n?n.column:null],u=0,c=o;u<c.length;u++)for(var s=c[u],l=0,f=a;l<f.length;l++){var d=f[l],p=(s?"_"+s:"")+(d?"_"+d:""),h={row:s,column:d};i.push(zs(e.spec,this,this.getName("child"+p),void 0,h,r,!1))}return i},t.prototype.parseLayoutSize=function(){ts(this)},t.prototype.assembleDefaultLayout=function(){return{columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},t}(ps);function zs(e,t,n,r,i,o,a){if(Yi(e))return new ls(e,t,n,i,o);if(Xi(e))return new Ds(e,t,n,r,i,o,a);if(Vi(e))return new As(e,t,n,r,i,o,a);if(Qi(e))return new Is(e,t,n,i,o);if(Ki(e))return new hs(e,t,n,i,o);throw new Error(Zt.INVALID_SPEC)}var Rs=Object.freeze({}),Ls={text:["text"],line:["x","y"],trail:["x","y"],area:["x","y"]},Fs={bar:v(["row","column","x","y","size","color","fill","stroke","detail"]),line:v(["row","column","x","y","color","fill","stroke","color","detail"]),trail:v(["row","column","x","y","color","fill","stroke","color","detail","size"]),area:v(["row","column","x","y","color","fill","stroke","detail"]),tick:v(["row","column","x","y","color","fill","stroke","detail"]),circle:v(["row","column","x","y","color","fill","stroke","size","detail"]),square:v(["row","column","x","y","color","fill","stroke","size","detail"]),point:v(["row","column","x","y","color","fill","stroke","size","detail","shape"]),geoshape:v(["row","column","color","fill","stroke","detail","shape"]),text:v(["row","column","size","color","fill","stroke","text"])};var js=Object.freeze({DEFAULT_REQUIRED_CHANNEL_MAP:Ls,DEFAULT_SUPPORTED_CHANNEL_TYPE:Fs,getEncodingMappingError:function(e,t,n){void 0===t&&(t=Ls),void 0===n&&(n=Fs);var r=Xt(e.mark)?e.mark.type:e.mark,i=e.encoding,o=t[r],a=n[r];for(var u in o)if(!(o[u]in i))return'Missing encoding channel "'+o[u]+'" for mark "'+r+'"';for(var c in i)if(!a[c])return'Encoding channel "'+c+'" is not supported by mark type "'+r+'"';return r!==Rt||i.x||i.y?null:"Missing both x and y for bar"}}),Us="2.6.0";e.aggregate=Te,e.axis=je,e.bin=It,e.channel=_t,e.compositeMark=Yr,e.config=Pi,e.data=mo,e.datetime=xn,e.encoding=Lr,e.facet=Rs,e.fieldDef=_r,e.header=qo,e.legend=$r,e.mark=cn,e.scale=Ti,e.sort=Bo,e.spec=oo,e.stack=Bi,e.timeUnit=Mn,e.transform=Gc,e.type=Xn,e.util=be,e.validate=js,e.version=Us,e.compile=function(e,t){var n,r,i;void 0===t&&(t={}),t.logger&&(n=t.logger,ln=n),t.fieldTitle&&pr(t.fieldTitle);try{var o=zi(ee({},t.config,e.config)),a=$i(e,o),u=function(e,t,n){void 0===n&&(n=!0);var r=x({type:"pad"},ao(t),ao(e));return"fit"===r.type&&(n||(fn(Zt.FIT_NON_SINGLE),r.type="pad")),r}(e.autosize,o.autosize,Xi(a)||Vi(a)),c=zs(a,null,"",void 0,void 0,o,"fit"===u.type);return c.parse(),r=c.component.data,(i=ae(r.sources)).forEach(Su),Eu(i=i.filter(function(e){return e.numChildren()>0})).forEach(hu(gu)),Eu(i=i.filter(function(e){return e.numChildren()>0})).forEach(hu(mu)),Eu(i).forEach(vu),i.forEach(xu),oe(r.sources).forEach(function(e){0===r.sources[e].numChildren()&&delete r.sources[e]}),function(e,t){var n=e.config?ji(e.config):void 0,r=[].concat(e.assembleSelectionData([]),function(e,t){var n=ae(e.sources),r=[],i=$c(r),o=0;n.forEach(function(e){e.hasName()||(e.dataName="source_"+o++);var t=e.assemble();i(e,t)}),r.forEach(function(e){0===e.transform.length&&delete e.transform});for(var a=0,u=0;u<r.length;u++)0!==((m=r[u]).transform||[]).length||m.source||r.splice(a++,0,r.splice(u,1)[0]);for(var c=0,s=r;c<s.length;c++)for(var l=0,f=(m=s[c]).transform||[];l<f.length;l++){var d=f[l];"lookup"===d.type&&(d.from=e.outputNodes[d.from].getSource())}for(var p=0,h=r;p<h.length;p++){var m;(m=h[p]).name in t&&(m.values=t[m.name])}return r}(e.component.data,t.datasets||{}));delete t.datasets;var i=e.assembleProjections(),o=e.assembleTitle(),a=e.assembleGroupStyle(),u=e.assembleLayoutSignals();return u=u.filter(function(e){return"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)}),{spec:x({$schema:"https://vega.github.io/schema/vega/v3.json"},e.description?{description:e.description}:{},t,o?{title:o}:{},a?{style:a}:{},{data:r},i.length>0?{projections:i}:{},e.assembleGroup(u.concat(e.assembleSelectionTopLevelSignals([]))),n?{config:n}:{})}}(c,function(e,t,n){return x({autosize:1===oe(n).length&&n.type?n.type:n},co(t),co(e))}(e,o,u))}finally{t.logger&&(ln=sn),t.fieldTitle&&hr()}},Object.defineProperty(e,"__esModule",{value:!0})});